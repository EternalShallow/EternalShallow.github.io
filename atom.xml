<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>DongFei</title>
  
  <subtitle>爱生活的懒飞</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-05-16T06:52:45.128Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>zhangdongfei</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>CSS实现书签效果</title>
    <link href="http://yoursite.com/2019/05/16/bookmark/"/>
    <id>http://yoursite.com/2019/05/16/bookmark/</id>
    <published>2019-05-16T03:19:26.000Z</published>
    <updated>2019-05-16T06:52:45.128Z</updated>
    
    <content type="html"><![CDATA[<h3><span id="前言">前言</span></h3><p>&quot;舔狗&quot;，网络用语，指那些不顾一切去讨好他人的人。</p><p>俗话说，人在职场走哪能不添狗，虽说这是职场化解矛盾的利器之一，但是作为伟大而骄傲的程序员岂能不顾一切的去舔狗，于是乎能自己动手的绝不舔。</p><p>就像跟UI的大战，让给你改个图能叨叨你半天，切个图，画个图，那口水战那绝对是一个持久战，此外不说可能给你的图还不能用...</p><p>总之，能自己动手的，别叨叨，自己动手丰衣足食</p><p><a href="https://github.com/EternalShallow/vue-test-demo/tree/master/src/pages/bookmark" target="_blank" rel="noopener"><strong>项目地址</strong></a></p><h3><span id="书签">书签</span></h3><p>就拿常用的一些图标来说，自己完全可以实现嘛，自己动手喽。</p><p>在开始之前我们先来重温 border的属性以及各个边框颜色的设置</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.border-co&#123;</span><br><span class="line">      width: 100px;</span><br><span class="line">      height: 100px;</span><br><span class="line">      border: 100px solid;</span><br><span class="line">      border-color: red green blue yellow;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>效果如下：<img src="/images/bookmark-0.jpg" alt="image"></p><p>下面是一个书签的展示：</p><p><img src="/images/bookmark-1.jpg" alt="image"></p><p>想要实现右上角的标签，可以分为三部分，夹角、文字、最右边的小角，按照思路我们可以想象夹角和小角可以看做是一个div的一部分，那么我们可以通过设置背景色和border的宽度来实现。先看布局：</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;img-box&quot;&gt;</span><br><span class="line">  &lt;img alt=&quot;&quot; src=&quot;./images/new_user_welcome.jpeg&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;tag-t-box&quot;&gt;</span><br><span class="line">    &lt;span class=&quot;txt&quot;&gt;标签标签&lt;/span&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p><p>再来看下样式：</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.img-box&#123;</span><br><span class="line">      width: 100%;</span><br><span class="line">      padding-bottom: 20px;</span><br><span class="line">      position: relative;</span><br><span class="line">      img&#123;</span><br><span class="line">        display: block;</span><br><span class="line">        width: 100%;</span><br><span class="line">        border-radius: 9px;</span><br><span class="line">        box-shadow: 4px 4px 14px 0 rgba(64, 60, 60, 0.22);</span><br><span class="line">      &#125;</span><br><span class="line">      .tag-t-box&#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        right: -10px;</span><br><span class="line">        top: 20px;</span><br><span class="line">        background: rgba(1, 14, 2, 0.8);</span><br><span class="line">        width: 120px;</span><br><span class="line">        line-height: 48px;</span><br><span class="line">        text-align: left;</span><br><span class="line">        height: 48px;</span><br><span class="line">        color: #fff;</span><br><span class="line">        font-size: 26px;</span><br><span class="line">        font-weight: bold;</span><br><span class="line">        // 小角</span><br><span class="line">        &amp;::before &#123;</span><br><span class="line">          content: &apos;&apos;;</span><br><span class="line">          position: absolute;</span><br><span class="line">          top: -4px;</span><br><span class="line">          right: 0;</span><br><span class="line">          border: 4px solid rgba(1, 14, 2, 0.8);</span><br><span class="line">          border-top-color: transparent;</span><br><span class="line">          border-right-color: transparent;</span><br><span class="line">          border-top-width: 2px;</span><br><span class="line">          border-bottom-width: 2px;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        // 夹角</span><br><span class="line">        &amp;::after &#123;</span><br><span class="line">          content: &apos;&apos;;</span><br><span class="line">          position: absolute;</span><br><span class="line">          right: 120px;</span><br><span class="line">          z-index: 1;</span><br><span class="line">          width: 0;</span><br><span class="line">          height: 0;</span><br><span class="line">          line-height: 0;</span><br><span class="line">          color: #21232e;</span><br><span class="line">          border: 24px solid rgba(1, 14, 2, 0.8);</span><br><span class="line">          border-left-color: transparent;</span><br><span class="line">          border-left-width: 24px;</span><br><span class="line">          /*padding-right: 3px;*/</span><br><span class="line">          text-align: left;</span><br><span class="line">          text-decoration: none;</span><br><span class="line">          font-size: 24px;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>我们来分析一下代码首先看小角的，设置了 border: 4px solid rgba(1, 14, 2, 0.8); 可以看出高度是4px，然后border-top-color: transparent;和 border-right-color: transparent; 右上的颜色设置为透明，这样右上角就没了，再设置 border-top-width: 2px;和border-bottom-width: 2px; 撑开剩余的高度（PS：这两块不设置也是可以的，只是显示的那一部分小了2px，看实际需要的小角的大小来决定）</p><p>接着我们再来看看夹角的，因为夹角是向左的结合刚开始的border的各个属性，我们可以设置左侧的border颜色为#fff或者border-left-color: transparent;设置为透明色（PS：透明色百搭）</p><p>理解了这个那么我们的书签就实现了下边是各种方向的书签效果</p><p><img src="/images/bookmark-2.jpg" alt="image"></p><p>实现代码：</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">.img-box&#123;</span><br><span class="line">      width: 100%;</span><br><span class="line">      /*border-radius: 9px;*/</span><br><span class="line">      padding-bottom: 20px;</span><br><span class="line">      position: relative;</span><br><span class="line">      img&#123;</span><br><span class="line">        display: block;</span><br><span class="line">        width: 100%;</span><br><span class="line">        border-radius: 9px;</span><br><span class="line">        box-shadow: 4px 4px 14px 0 rgba(64, 60, 60, 0.22);</span><br><span class="line">      &#125;</span><br><span class="line">      .tag-t-box&#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        left: -10px;</span><br><span class="line">        bottom: 40px;</span><br><span class="line">        background: rgba(1, 14, 2, 0.8);</span><br><span class="line">        width: 120px;</span><br><span class="line">        line-height: 48px;</span><br><span class="line">        text-align: right;</span><br><span class="line">        height: 48px;</span><br><span class="line">        color: #fff;</span><br><span class="line">        font-size: 26px;</span><br><span class="line">        font-weight: bold;</span><br><span class="line">        &amp;::before &#123;</span><br><span class="line">          content: &apos;&apos;;</span><br><span class="line">          position: absolute;</span><br><span class="line">          left: 120px;</span><br><span class="line">          z-index: 1;</span><br><span class="line">          width: 6px;</span><br><span class="line">          height: 0;</span><br><span class="line">          line-height: 0;</span><br><span class="line">          color: #21232e;</span><br><span class="line">          border: 24px solid rgba(1, 14, 2, 0.8);</span><br><span class="line">          border-right-color: #fff;</span><br><span class="line">          border-right-width: 24px;</span><br><span class="line">          text-align: left;</span><br><span class="line">          text-decoration: none;</span><br><span class="line">          font-size: 24px;</span><br><span class="line">        &#125;</span><br><span class="line">        // 夹角</span><br><span class="line">        &amp;::after &#123;</span><br><span class="line">          content: &apos;&apos;;</span><br><span class="line">          position: absolute;</span><br><span class="line">          top: -4px;</span><br><span class="line">          left: 0;</span><br><span class="line">          border: 4px solid rgba(1, 14, 2, 0.8);</span><br><span class="line">          /*border-top-width: 2px;*/</span><br><span class="line">          /*border-bottom-width: 2px;*/</span><br><span class="line">          border-left-color: transparent;</span><br><span class="line">          border-top-color: transparent;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p><img src="/images/bookmark-3.jpg" alt="image"></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;img-box2&quot;&gt;</span><br><span class="line">  &lt;img alt=&quot;&quot; src=&quot;./images/new_user_welcome.jpeg&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;tag-p-box1&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;txt&quot;&gt;详情&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.img-box2&#123;</span><br><span class="line">      width: 100%;</span><br><span class="line">      /*border-radius: 9px;*/</span><br><span class="line">      padding-bottom: 20px;</span><br><span class="line">      position: relative;</span><br><span class="line">      img&#123;</span><br><span class="line">        display: block;</span><br><span class="line">        width: 100%;</span><br><span class="line">        border-radius: 9px;</span><br><span class="line">        box-shadow: 4px 4px 14px 0 rgba(64, 60, 60, 0.22);</span><br><span class="line">      &#125;</span><br><span class="line">      .tag-p-box1&#123;</span><br><span class="line">        position: absolute;</span><br><span class="line">        top: 0;</span><br><span class="line">        right: 40px;</span><br><span class="line">        height: 100px;</span><br><span class="line">        border: 20px solid rgba(1, 14, 2, 0.8);</span><br><span class="line">        border-bottom-width: 20px;</span><br><span class="line">        border-bottom-color: transparent;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">        .txt&#123;</span><br><span class="line">          display: inline-block;</span><br><span class="line">          position: absolute;</span><br><span class="line">          top: -28px;</span><br><span class="line">          left: -20px;</span><br><span class="line">          width: 40px;</span><br><span class="line">          height: 100px;</span><br><span class="line">          line-height: 40px;</span><br><span class="line">          writing-mode: vertical-lr;</span><br><span class="line">          text-align: center;</span><br><span class="line">          color: #fff;</span><br><span class="line">          font-size: 26px;</span><br><span class="line">          font-weight: bold;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>虽然border:1px solid black看起来很简单，但是对我们的帮助很大，充分发挥我们的脑洞，拒接向UI低头</p></blockquote><blockquote><p><strong>我们伟大的程序员无所不能</strong></p></blockquote>]]></content>
    
    <summary type="html">
    
      俗话说，人在职场走哪能不添狗，虽说这是职场化解矛盾的利器之一，但是作为伟大而骄傲的程序员岂能不顾一切的去舔狗
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="css" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/css/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="css" scheme="http://yoursite.com/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>原生JS封装AJAX请求</title>
    <link href="http://yoursite.com/2019/05/11/js-ajax/"/>
    <id>http://yoursite.com/2019/05/11/js-ajax/</id>
    <published>2019-05-11T02:32:14.000Z</published>
    <updated>2019-05-11T02:41:40.230Z</updated>
    
    <content type="html"><![CDATA[<h3><span id="前言">前言</span></h3><p>一直在用jQuery方法来写ajax请求，用的多了，不免对这其中是怎么实现的产生了兴趣，于是乎，小弟闲来无聊研究了一下原生实现ajax请求，网上看了很多前辈们的关于ajax请求的封装方法，也借鉴了很多经验，于是乎就出现了小弟的一个原生JS封装ajax的版本，希望大家看了之后能够明白，下面就是我实现的方法，其中的注释很清晰，方便大家的理解。</p><h3><span id="实现">实现</span></h3><p>新建文件夹 ajax.js</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br></pre></td><td class="code"><pre><span class="line">!(function (wd) &#123;</span><br><span class="line">wd._$ = new function () &#123;</span><br><span class="line">//ajax模块</span><br><span class="line">let Ajax = &#123;</span><br><span class="line">//ajax模块</span><br><span class="line">init: function (obj) &#123;</span><br><span class="line">//初始化数据</span><br><span class="line">var objAdapter = &#123;</span><br><span class="line">url: obj.url || &apos;&apos;,</span><br><span class="line">type: obj.type || &apos;get&apos;,</span><br><span class="line">dataType: obj.dataType || &quot;json&quot;,</span><br><span class="line">data: (obj.type &amp;&amp; obj.type.toLowerCase() == &quot;get&quot; ? (Ajax.params(obj.data)) : obj.data) || &quot;get&quot;,</span><br><span class="line">contentType: obj.contentType || &apos;application/json&apos;,</span><br><span class="line">success: obj.success || function () &#123; &#125;,</span><br><span class="line">complete: obj.complete || function () &#123; &#125;,</span><br><span class="line">error: obj.error || function (s) &#123;</span><br><span class="line">alert(&apos;status:&apos; + s + &apos;error!&apos;);</span><br><span class="line">&#125;,</span><br><span class="line">accepts: &#123;</span><br><span class="line">script: &apos;text/javascript, application/javascript, application/x-javascript&apos;,</span><br><span class="line">json: &apos;application/json&apos;,</span><br><span class="line">xml: &apos;application/xml, text/xml&apos;,</span><br><span class="line">html: &apos;text/html&apos;,</span><br><span class="line">text: &apos;text/plain&apos;</span><br><span class="line">&#125;,</span><br><span class="line">async: obj.async ? true : false</span><br><span class="line">&#125;</span><br><span class="line">//通过使用JS随机字符串解决IE浏览器第二次默认获取缓存的问题</span><br><span class="line">return objAdapter;</span><br><span class="line">&#125;,</span><br><span class="line">//创建XMLHttpRequest对象</span><br><span class="line">createXHR: function () &#123;</span><br><span class="line">if (window.XMLHttpRequest) &#123; //IE7+、Firefox、Opera、Chrome 和Safari</span><br><span class="line">return new XMLHttpRequest();</span><br><span class="line">&#125; else if (window.ActiveXObject) &#123; //IE6 及以下</span><br><span class="line">var versions = [&apos;MSXML2.XMLHttp&apos;, &apos;Microsoft.XMLHTTP&apos;];</span><br><span class="line">for (var i = 0, len = versions.length; i &lt; len; i++) &#123;</span><br><span class="line">try &#123;</span><br><span class="line">return new ActiveXObject(version[i]);</span><br><span class="line">break;</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">//跳过</span><br><span class="line">console.error(e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">throw new Error(&apos;浏览器不支持XHR对象！&apos;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">paramsData: function (options) &#123;</span><br><span class="line">function appendQuery(url, query) &#123;</span><br><span class="line">if (query == &apos;&apos;) return url</span><br><span class="line">return (url + &apos;&amp;&apos; + query).replace(/[&amp;?]&#123;1,2&#125;/, &apos;?&apos;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (options.data)</span><br><span class="line">options.data = Ajax.params(options.data)</span><br><span class="line">if (options.data &amp;&amp; (!options.type || options.type.toUpperCase() == &apos;GET&apos; || &apos;jsonp&apos; == options.dataType)) &#123;</span><br><span class="line">options.url = appendQuery(options.url, options.data), options.data = undefined</span><br><span class="line">&#125;</span><br><span class="line">return options;</span><br><span class="line">&#125;,</span><br><span class="line">params: function (data) &#123;</span><br><span class="line">var arr = [];</span><br><span class="line">for (var i in data) &#123;</span><br><span class="line">//特殊字符传参产生的问题可以使用encodeURIComponent()进行编码处理</span><br><span class="line">arr.push(encodeURIComponent(i) + &apos;=&apos; + encodeURIComponent(data[i]));</span><br><span class="line">&#125;</span><br><span class="line">return arr.join(&apos;&amp;&apos;);</span><br><span class="line">&#125;,</span><br><span class="line">callback: function (obj, xhr) &#123;</span><br><span class="line">var result, dataType, error = false;</span><br><span class="line">if ((xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) || xhr.status === 304) &#123; // || (xhr.status === 0 &amp;&amp; protocol === &apos;file:&apos;)) &#123;</span><br><span class="line">if (xhr.responseType === &apos;arraybuffer&apos; || xhr.responseType === &apos;blob&apos;) &#123;</span><br><span class="line">result = xhr.response;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">result = xhr.responseText;</span><br><span class="line">dataType = obj.dataType ? obj.dataType : xhr.getResponseHeader(&apos;content-type&apos;).split(&apos;;&apos;, 1)[0];</span><br><span class="line">for (var i in obj.accepts) &#123;</span><br><span class="line">if (obj.accepts.hasOwnProperty(i) &amp;&amp; obj.accepts[i].indexOf(dataType) &gt; -1) dataType = i;</span><br><span class="line">&#125;</span><br><span class="line">try &#123;</span><br><span class="line">if (dataType === &apos;script&apos;) &#123;</span><br><span class="line">eval(result);</span><br><span class="line">&#125; else if (dataType === &apos;xml&apos;) &#123;</span><br><span class="line">result = xhr.responseXML</span><br><span class="line">&#125; else if (dataType === &apos;json&apos; || dataType == &quot;application/json&quot;) &#123;</span><br><span class="line">result = result.trim() === &apos;&apos; ? null : JSON.parse(result)</span><br><span class="line">&#125;</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">obj.error &amp;&amp; obj.error(e, xhr);</span><br><span class="line">xhr.abort();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.success &amp;&amp; obj.success(result, xhr);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">obj.error &amp;&amp; obj.error(xhr.statusText, xhr);</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">ajax: function (obj) &#123;</span><br><span class="line">if (obj.type &amp;&amp; obj.type.toLowerCase() === &apos;post&apos;) &#123;</span><br><span class="line">Ajax.post(obj);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">Ajax.get(obj);</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">//post方法</span><br><span class="line">post: function (obj) &#123;</span><br><span class="line">var xhr = Ajax.createXHR(); //创建XHR对象</span><br><span class="line">var opt = Ajax.init(obj);</span><br><span class="line">opt.type = &apos;post&apos;;</span><br><span class="line">if (opt.async === true) &#123; //true表示异步，false表示同步</span><br><span class="line">//使用异步调用的时候，需要触发readystatechange 事件</span><br><span class="line">xhr.onreadystatechange = function () &#123;</span><br><span class="line">if (xhr.readyState == 4) &#123; //判断对象的状态是否交互完成</span><br><span class="line">Ajax.callback(opt, xhr); //回调</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line">//在使用XHR对象时，必须先调用open()方法，</span><br><span class="line">//它接受三个参数：请求类型(get、post)、请求的URL和表示是否异步。</span><br><span class="line">xhr.open(opt.type, opt.url, opt.async);</span><br><span class="line">//post方式需要自己设置http的请求头，来模仿表单提交。</span><br><span class="line">//放在open方法之后，send方法之前。</span><br><span class="line">xhr.setRequestHeader(&apos;Content-Type&apos;, opt.contentType ? opt.contentType : &apos;application/x-www-form-urlencoded&apos;);</span><br><span class="line">xhr.send(opt.data); //post方式将数据放在send()方法里</span><br><span class="line">if (opt.async === false) &#123; //同步</span><br><span class="line">Ajax.callback(opt, xhr); //回调</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">//get方法</span><br><span class="line">get: function (obj) &#123;</span><br><span class="line">var xhr = Ajax.createXHR(); //创建XHR对象</span><br><span class="line">var opt = Ajax.init(obj);</span><br><span class="line">if (opt.async === true) &#123; //true表示异步，false表示同步</span><br><span class="line">//使用异步调用的时候，需要触发readystatechange 事件</span><br><span class="line">xhr.onreadystatechange = function () &#123;</span><br><span class="line">if (xhr.readyState == 4) &#123; //判断对象的状态是否交互完成</span><br><span class="line">Ajax.callback(obj, xhr); //回调</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line">//若是GET请求，则将数据加到url后面</span><br><span class="line">/* opt.url += opt.url.indexOf(&apos;?&apos;) == -1 ? &apos;?&apos; + opt.data : &apos;&amp;&apos; + opt.data;</span><br><span class="line">opt.url += opt.url.indexOf(&apos;?&apos;) == -1 ? &apos;?&apos; + (&apos;_=&apos; + (new Date().getTime())) : &apos;&amp;&apos; + (&apos;_=&apos; + new Date().getTime()); */</span><br><span class="line"></span><br><span class="line">//在使用XHR对象时，必须先调用open()方法，</span><br><span class="line">//它接受三个参数：请求类型(get、post)、请求的URL和表示是否异步。</span><br><span class="line">xhr.open(opt.type, opt.url, opt.async);</span><br><span class="line">xhr.send(null); //get方式则填null</span><br><span class="line">if (opt.async === false) &#123; //同步</span><br><span class="line">Ajax.callback(opt, xhr); //回调</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">return Ajax;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  fetch get请求</span><br><span class="line"> * @param &#123;Object&#125; param</span><br><span class="line"> */</span><br><span class="line">wd.getFetch = function (param) &#123;</span><br><span class="line">if (param.data) &#123;</span><br><span class="line">let paramsArray = [];</span><br><span class="line">//拼接参数</span><br><span class="line">Object.keys(param.data).forEach(key =&gt; paramsArray.push(key + &apos;=&apos; + param.data[key]))</span><br><span class="line">if (param.path.search(/\?/) === -1) &#123;</span><br><span class="line">param.path += &apos;?&apos; + paramsArray.join(&apos;&amp;&apos;)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">param.path += &apos;&amp;&apos; + paramsArray.join(&apos;&amp;&apos;)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">window.fetch(param.path, &#123;</span><br><span class="line">mode: &quot;no-cors&quot;,</span><br><span class="line">type: &apos;GET&apos;,</span><br><span class="line">credentials: &quot;include&quot;, //same-origin</span><br><span class="line">headers: &#123;</span><br><span class="line">&apos;Accept&apos;: &apos;application/json&apos;,</span><br><span class="line">&apos;Content-Type&apos;: &apos;application/json&apos;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;).then((rep) =&gt; rep.json()).then(data =&gt; &#123;</span><br><span class="line">param.success &amp;&amp; param.success(data);</span><br><span class="line">&#125;).catch(function (error) &#123;</span><br><span class="line">param.error &amp;&amp; param.error(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * fetch post请求</span><br><span class="line"> * @param &#123;Object&#125; param</span><br><span class="line"> */</span><br><span class="line">wd.postFetch = function (param) &#123;</span><br><span class="line">var fromData = new FormData();</span><br><span class="line">if (param.data) &#123;</span><br><span class="line">for (var key in param.data) &#123;</span><br><span class="line">fromData.append(key, data[key]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">window.fetch(param.path, &#123;</span><br><span class="line">mode: &quot;cors&quot;, //&quot;no-cors&quot;,</span><br><span class="line">type: &apos;POST&apos;,</span><br><span class="line">cache: &apos;default&apos;,</span><br><span class="line">credentials: &quot;include&quot;, //same-origin</span><br><span class="line">headers: &#123;</span><br><span class="line">&apos;Accept&apos;: &apos;application/x-www-form-urlencoded&apos;,</span><br><span class="line">&apos;Access-Control-Allow-Origin&apos;: &apos;*&apos;,</span><br><span class="line">&apos;Access-Control-Allow-Methods&apos;: &apos;POST, GET, OPTIONS, PUT, DELETE&apos;,</span><br><span class="line">&quot;Content-Type&quot;: &quot;application/json&quot;,</span><br><span class="line">&quot;Accept&quot;: &quot;application/json&quot;</span><br><span class="line">&#125;,</span><br><span class="line">body: fromData || &#123;&#125;</span><br><span class="line">&#125;).then((rep) =&gt; rep.json()).then(data =&gt; &#123;</span><br><span class="line">param.success &amp;&amp; param.success(data);</span><br><span class="line">&#125;).catch(function (error) &#123;</span><br><span class="line">param.error &amp;&amp; param.error(error);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;(window));</span><br></pre></td></tr></table></figure></p><h3><span id="在vue-中的二次封装">在Vue 中的二次封装</span></h3><p>新建文件  http.js</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import &apos;./ajax&apos;;</span><br><span class="line">//ajax公共方法</span><br><span class="line">export default &#123;</span><br><span class="line">  comAjax(param) &#123;</span><br><span class="line">    _$.ajax(&#123;</span><br><span class="line">      type: param.method || &apos;post&apos;,</span><br><span class="line">      data: param.data,</span><br><span class="line">      async: param.async != false,</span><br><span class="line">      url: param.url || &apos;&apos;,</span><br><span class="line">      contentType: param.contentType ? &apos;application/json&apos; : &apos;&apos;,</span><br><span class="line">      success(data) &#123;  // 成功回调</span><br><span class="line">        return param.success &amp;&amp; param.success(data);</span><br><span class="line">      &#125;,</span><br><span class="line">      error(err) &#123;</span><br><span class="line">        utils.view.dismissLoading(); // 关闭loading</span><br><span class="line">        return param.error &amp;&amp; param.error(err);  // error处理</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><h3><span id="在vue-中的引用-post">在Vue 中的引用---POST</span></h3><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*</span><br><span class="line">* @param param 参数</span><br><span class="line">* @param cb  回调方法</span><br><span class="line">* @returns &#123;*&#125;</span><br><span class="line">*/</span><br><span class="line">apiAppointList(param, cb) &#123;</span><br><span class="line">    return api.comAjax(&#123;</span><br><span class="line">      url: `url/$&#123;param.uid&#125;/$&#123;param.id&#125;`,</span><br><span class="line">      method: &apos;post&apos;,</span><br><span class="line">      contentType: &apos;application/json&apos;,</span><br><span class="line">      data: JSON.stringify(params),</span><br><span class="line">      success(data) &#123;</span><br><span class="line">        return cb &amp;&amp; cb(data);</span><br><span class="line">      &#125;,</span><br><span class="line">      error(err) &#123;</span><br><span class="line">        return utils.toast(err.message);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">getAppointList()&#123;</span><br><span class="line">    utils.view.showLoading();  // 显示loading</span><br><span class="line">    this.apiAppointList(data, result =&gt; &#123;</span><br><span class="line">      utils.view.dismissLoading() // 关闭loading</span><br><span class="line">      if (result.code !== 200) &#123;</span><br><span class="line">        return utils.toast(result.message)</span><br><span class="line">      &#125;</span><br><span class="line">      if (result.data.length &lt; 1)&#123;</span><br><span class="line">        utils.toast(&quot;暂无数据&quot;)</span><br><span class="line">      &#125;</span><br><span class="line">      ***</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p><h3><span id="在vue-中的引用-get">在Vue 中的引用---GET</span></h3><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * @param param 参数</span><br><span class="line"> * @param cb  回调方法</span><br><span class="line"> * @returns &#123;*&#125;</span><br><span class="line"> */</span><br><span class="line"> apiAppointList(param, cb) &#123;</span><br><span class="line">     return api.comAjax(&#123;</span><br><span class="line">       url: `url/$&#123;param.uid&#125;/$&#123;param.id&#125;`,</span><br><span class="line">       method: &apos;get&apos;,</span><br><span class="line">       success(data) &#123;</span><br><span class="line">         return cb &amp;&amp; cb(data);</span><br><span class="line">       &#125;,</span><br><span class="line">       error(err) &#123;</span><br><span class="line">         return utils.toast(err.message);</span><br><span class="line">       &#125;,</span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;,</span><br><span class="line"> getAppointList()&#123;</span><br><span class="line">     utils.view.showLoading();  // 显示loading</span><br><span class="line">     this.apiAppointList(data, result =&gt; &#123;</span><br><span class="line">       utils.view.dismissLoading() // 关闭loading</span><br><span class="line">       if (result.code !== 200) &#123;</span><br><span class="line">         return utils.toast(result.message)</span><br><span class="line">       &#125;</span><br><span class="line">       if (result.data.length &lt; 1)&#123;</span><br><span class="line">         utils.toast(&quot;暂无数据&quot;)</span><br><span class="line">       &#125;</span><br><span class="line">       ***</span><br><span class="line">     &#125;)</span><br><span class="line">   &#125;,</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure></p><h3><span id="结语">结语</span></h3><p>封装以上的方法主要是因为原生js传递请求参数比较麻烦，于是乎改良了一下，希望对大家有帮助，喜欢我的文章的话，就给我来个喜欢吧，</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3&gt;&lt;span id=&quot;前言&quot;&gt;前言&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;一直在用jQuery方法来写ajax请求，用的多了，不免对这其中是怎么实现的产生了兴趣，于是乎，
小弟闲来无聊研究了一下原生实现ajax请求，网上看了很多前辈们的关于ajax请求的封装方法，
也借鉴了很多经验
      
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="js" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/js/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="js" scheme="http://yoursite.com/tags/js/"/>
    
      <category term="ajax" scheme="http://yoursite.com/tags/ajax/"/>
    
  </entry>
  
  <entry>
    <title>Hexo Course</title>
    <link href="http://yoursite.com/2019/05/11/hello-world/"/>
    <id>http://yoursite.com/2019/05/11/hello-world/</id>
    <published>2019-05-11T01:45:16.685Z</published>
    <updated>2019-05-11T01:45:16.685Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2><span id="quick-start">Quick Start</span></h2><h3><span id="create-a-new-post">Create a new post</span></h3><p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure></p><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3><span id="run-server">Run server</span></h3><p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure></p><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3><span id="generate-static-files">Generate static files</span></h3><p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure></p><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3><span id="deploy-to-remote-sites">Deploy to remote sites</span></h3><p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure></p><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>async+phantomjs制作nodejs的小说爬虫</title>
    <link href="http://yoursite.com/2019/04/26/node-novel/"/>
    <id>http://yoursite.com/2019/04/26/node-novel/</id>
    <published>2019-04-26T08:50:41.000Z</published>
    <updated>2019-05-11T01:45:16.685Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="asyncphantomjs制作nodejs的小说爬虫">async+phantomjs制作nodejs的小说爬虫</span></h2><h3><span id="内容要点">内容要点</span></h3><p><strong>一步一脚印实现一个爬虫,文章内容较长,建议在pc下阅读</strong></p><p><strong><a href="https://github.com/EternalShallow/node-novel/" target="_blank" rel="noopener">源码地址</a></strong></p><p>phantomjs捕获内容 详细介绍通过async.mapLimit并发处理,结合定时器进行延时执行</p><p>数据输出成文件保存到本地 (如有错误请大家指出，一起学习)</p><h3><span id="目录结构">目录结构</span></h3><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── asyncFetch.js</span><br><span class="line">├── book</span><br><span class="line">│   └── default</span><br><span class="line">├── mock</span><br><span class="line">│   └── bookInfo.json</span><br><span class="line">├── fetchAllChapters.js</span><br><span class="line">├── fetchChapter.js</span><br><span class="line">├── note.md</span><br><span class="line">├── package.json</span><br><span class="line">├── taskHandler.js</span><br><span class="line">├── test.js</span><br></pre></td></tr></table></figure></p><hr><h3><span id="介绍有了解可以直接跳过">介绍(有了解可以直接跳过)</span></h3><hr><p>关于<a href="http://www.infoq.com/cn/news/2015/01/phantomjs-webkit-javascript-api" target="_blank" rel="noopener">PhantomJS</a>首先介绍一下phantomjs</p><blockquote><p>PhantomJS是一个基于WebKit的服务器端JavaScript API，它基于 BSD开源协议发布。PhantomJS无需浏览器的支持即可实现对Web的支持，且原生支持各种Web标准，如DOM 处理、JavaScript、CSS选择器、JSON、Canvas和可缩放矢量图形SVG。PhantomJS主要是通过JavaScript和CoffeeScript控制WebKit的CSS选择器、可缩放矢量图形SVG和HTTP网络等各个模块。</p></blockquote><hr><h3><span id="phantomjs的应用场景">phantomjs的应用场景</span></h3><hr><blockquote><p>无需浏览器的Web测试：无需浏览器的情况下进行快速的Web测试，且支持很多测试框架，如YUI Test、Jasmine、WebDriver、Capybara、QUnit、Mocha等。页面自动化操作：使用标准的DOM API或一些JavaScript框架（如jQuery）访问和操作Web页面。屏幕捕获：以编程方式抓起CSS、SVG和Canvas等页面内容，即可实现网络爬虫应用。构建服务端Web图形应用，如截图服务、矢量光栅图应用。网络监控：自动进行网络性能监控、跟踪页面加载情况以及将相关监控的信息以标准的HAR格式导出。</p></blockquote><hr><p>基于phantomjs2.0进行实现有两种实现方案，一种是使用基于全局的 http://phantomjs.org/ ，另外一种是封装的模块 phantom - Fast NodeJS API for PhantomJS -https://github.com/amir20/phantomjs-node这里选择phantomjs-node关于phantomjs-node的安装以及入门使用可以根据百度前端学院2017中的<strong>网页抓取分析服务系列</strong>相关内容中学习,这里放一下之前phantomjs-node <a href="https://github.com/Sunshine168/ife" target="_blank" rel="noopener">学习的笔记和demo</a>中的phantomjs_1~4目录下后文也会进一步说明使用方法。</p><h2><span id="实现思路和过程">实现思路和过程</span></h2><h3><span id="实现思路">实现思路</span></h3><p>phantomjs就相当于一个无图形界面的浏览器,那么我们提供连接给phantomjs就意味着我们能获取这个url的内容。这次爬虫的内容是希望获取到小说的所有章节以及其内容,直接以笔阁网为例,因为这次爬虫是直接爬笔阁网的。我们打开http://www.qu.la/book/5443,</p><p>上面就有这本小说的许多章节,所以就有了第一步,或者这个页面上所有章节,通过&quot;开发者工具&quot;中的检查共功能</p><p>我们可以看到知道内容是这样的结构</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id =&quot;list&quot;&gt;</span><br><span class="line">&lt;dd&gt;</span><br><span class="line">&lt;a href=&quot;/**&quot;&gt;第xx章&lt;/a&gt;</span><br><span class="line">&lt;/dd&gt;</span><br><span class="line">....</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure></p><p>所以只要我们获取 id为list 中所有的dd,就获取了小说的所有章节,同时通过dd中a标签的href属性就可以连接到所有章节的内容。</p><p>爬虫方面的思路说明到这里</p><hr><h3><span id="实现过程">实现过程</span></h3><hr><p>(请保证node版本高于7.9,本文基于7.10.0)(最好先了解es7中async/await 以及child_process)如何使用phantomjs-nodejs</p><p>如何运行代码？。。将代码保存在一个js文件中例如test.js然后运行</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node test.js</span><br></pre></td></tr></table></figure></p><p><a href="https://github.com/Sunshine168/ife/tree/master/phantomjs_1" target="_blank" rel="noopener">参考</a></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const phantom = require(&apos;phantom&apos;);//导入模块</span><br><span class="line">//async解决回调问题,es7的内容</span><br><span class="line">(async function() &#123;</span><br><span class="line">     // await解决回调问题，创建一个phantom实例</span><br><span class="line">    const instance = await phantom.create();</span><br><span class="line">    //通过phantom实例创建一个page对象，page对象可以理解成一个对页面发起请求和处理结果这一集合的对象</span><br><span class="line">    const page = await instance.createPage();</span><br><span class="line">    //页面指向的是哪个一个url</span><br><span class="line">    await page.on(&quot;onResourceRequested&quot;, function(requestData) &#123;</span><br><span class="line">        console.info(&apos;Requesting&apos;, requestData.url)</span><br><span class="line">    &#125;);</span><br><span class="line">  //得到打开该页面的状态码</span><br><span class="line">    const status = await page.open(&apos;https://stackoverflow.com/&apos;);</span><br><span class="line">    console.log(status);</span><br><span class="line">//输出该页面的内容</span><br><span class="line">    const content = await page.property(&apos;content&apos;);</span><br><span class="line">    console.log(content);</span><br><span class="line">    //输出内容</span><br><span class="line">   //退出该phantom实例</span><br><span class="line">    await instance.exit();</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure></p><p>输出结果</p><p>当然不可能直接使用这些内容,所以就需要通过</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//这个方法,我的理解是跟你在chrome中的输出台的操作是一样的所以看看下面栗子</span><br><span class="line">await page.evaluate(function() &#123;&#125;);</span><br></pre></td></tr></table></figure></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">const phantom = require(&apos;phantom&apos;);</span><br><span class="line">let url = encodeURI(`https://www.baidu.com/s?wd=&quot;hello&quot;`);</span><br><span class="line">(async function() &#123;</span><br><span class="line">const instance = await phantom.create();</span><br><span class="line">const page = await instance.createPage();</span><br><span class="line">const status = await page.open(url);</span><br><span class="line">if (status !== &apos;success&apos;) &#123;</span><br><span class="line">console.log(&quot;访问失败&quot;);</span><br><span class="line">return;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">let start = Date.now();</span><br><span class="line">let result = await page.evaluate(function() &#123;</span><br><span class="line">return document.title</span><br><span class="line">&#125;);</span><br><span class="line">let data = &#123;</span><br><span class="line">cose: 1,</span><br><span class="line">msg: &quot;抓取成功&quot;,</span><br><span class="line">time: Date.now() - start,</span><br><span class="line">dataList: result</span><br><span class="line">&#125;</span><br><span class="line">console.log(JSON.stringify(data));</span><br><span class="line">await instance.exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure></p><p>输出结果</p><hr><h3><span id="模块实现">模块实现</span></h3><hr><p><strong>获取所有章节fetchAllChapters.js</strong></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">const phantom = require(&apos;phantom&apos;);</span><br><span class="line">const program = require(&apos;commander&apos;);</span><br><span class="line">/*</span><br><span class="line">  命令行参数帮助工具</span><br><span class="line">  设置 option b 代表 book ,[book]表示该参数可以通过program访问,这个参数表示书本编号</span><br><span class="line">  命令 eg:</span><br><span class="line">  node fetchAllChapters.js -b 5443</span><br><span class="line">*/</span><br><span class="line">program</span><br><span class="line">.version(&apos;0.1.0&apos;)</span><br><span class="line">.option(&apos;-b, --book [book]&apos;, &apos;book number&apos;)</span><br><span class="line">.parse(process.argv);</span><br><span class="line"></span><br><span class="line">//缺少书本参数直接退出</span><br><span class="line">if (!program.book) &#123;</span><br><span class="line">return</span><br><span class="line">&#125;</span><br><span class="line">// example &quot;5443&quot;,获取书本编号</span><br><span class="line">const bookNumber = program.book</span><br><span class="line">//访问的url</span><br><span class="line">const url = encodeURI(`http://www.qu.la/book/$&#123;bookNumber&#125;/`);</span><br><span class="line">//设置用户代理头</span><br><span class="line">const userAgent = `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36`</span><br><span class="line">try &#123;</span><br><span class="line">//提供async环境</span><br><span class="line">(async function() &#123;</span><br><span class="line">//创建实例</span><br><span class="line">const instance = await phantom.create()</span><br><span class="line">//创建页面容器</span><br><span class="line">const page = await instance.createPage()</span><br><span class="line">//设置</span><br><span class="line">page.setting(&quot;userAgent&quot;, userAgent)</span><br><span class="line">//判断是否访问成功</span><br><span class="line">const status = await page.open(url),</span><br><span class="line">code = 1;</span><br><span class="line">if (status !== &apos;success&apos;) &#123;</span><br><span class="line">//访问失败修改状态码</span><br><span class="line">code = -1;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">//获取当前时间</span><br><span class="line">var start = Date.now();</span><br><span class="line">var result = await page.evaluate(function() &#123;</span><br><span class="line">var count = 1;</span><br><span class="line">return $(&apos;#list dl dd&apos;).map(function() &#123;</span><br><span class="line">return (&#123;</span><br><span class="line">index: count++,</span><br><span class="line">title: $(this).find(&apos;a&apos;).html(),</span><br><span class="line">link: url + ($(this).find(&apos;a&apos;).attr(&apos;href&apos;)).substring(($(this).find(&apos;a&apos;).attr(&apos;href&apos;)).lastIndexOf(&quot;/&quot;)),</span><br><span class="line">&#125;)</span><br><span class="line">&#125;).toArray()</span><br><span class="line">&#125;)</span><br><span class="line">let data = &#123;</span><br><span class="line">code: code,</span><br><span class="line">bookNumber: &quot;5443&quot;,</span><br><span class="line">url: url,</span><br><span class="line">time: Date.now() - start,</span><br><span class="line">dataList: result</span><br><span class="line">&#125;</span><br><span class="line">console.log(JSON.stringify(data));</span><br><span class="line">&#125;</span><br><span class="line">//退出实例</span><br><span class="line">await instance.exit();</span><br><span class="line">&#125;)()</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">console.log(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>输出结果</p><p>在获取所有章节之后,我们需要获取所有章节的内容了</p><p><strong>fetchChapter</strong></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">const phantom = require(&apos;phantom&apos;);</span><br><span class="line">const mkdirp = require(&apos;mkdirp&apos;)</span><br><span class="line">const program = require(&apos;commander&apos;);</span><br><span class="line">const fs = require(&apos;async-file&apos;)</span><br><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">//设置用户代理</span><br><span class="line">const userAgent = `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36`</span><br><span class="line">/*</span><br><span class="line">命令行参数</span><br><span class="line">p -替换原文本中的换行空格</span><br><span class="line">f -保存为文件</span><br><span class="line">t 自定义输出路径</span><br><span class="line">u 抓取单章的url</span><br><span class="line">*/</span><br><span class="line">program</span><br><span class="line">    .version(&apos;0.1.0&apos;)</span><br><span class="line">    .option(&apos;-p, --puer&apos;, &apos;puerMode&apos;)</span><br><span class="line">    .option(&apos;-f, --file&apos;, &apos;save2File&apos;)</span><br><span class="line">    .option(&apos;-t, --path [path]&apos;, &apos;outPutPath&apos;)</span><br><span class="line">    .option(&apos;-u, --url [url]&apos;, &apos;url&apos;)</span><br><span class="line">    .parse(process.argv);</span><br><span class="line">if (!program.url) &#123;</span><br><span class="line">    return;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">const URL = program.url;</span><br><span class="line">const DEFAULT_PATH = &apos;/book/default/&apos;;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">替换br和&amp;nbsp标签</span><br><span class="line">*/</span><br><span class="line">function puer(str) &#123;</span><br><span class="line">    if (!str) &#123;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line">    str = str.replace(/&lt;br\s*\/?&gt;/gi, &quot;\r\n&quot;);</span><br><span class="line">    str = str.replace(/&amp;nbsp;/g, &quot; &quot;)</span><br><span class="line">    return str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">test url</span><br><span class="line">node fetchChapter.js -u http://www.qu.la/book/5443/3179374.html -f -p</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">(async function () &#123;</span><br><span class="line">    let code = 1</span><br><span class="line">    //创建实例</span><br><span class="line">    const instance = await phantom.create()</span><br><span class="line">    //创建页面容器</span><br><span class="line">    const page = await instance.createPage()</span><br><span class="line">    page.setting(&quot;userAgent&quot;, userAgent)</span><br><span class="line">    const status = await page.open(URL)</span><br><span class="line">    if (status !== &apos;success&apos;) &#123;</span><br><span class="line">        code = -1;</span><br><span class="line">        return;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        var start = Date.now();</span><br><span class="line">        var result = await page.evaluate(function () &#123;</span><br><span class="line">            //移除一些无关内容(等于直接在结果网页上的dom上进行操作)</span><br><span class="line">            //请注意这里如果调用console.log()是无效的!</span><br><span class="line">            $(&quot;#content a:last-child&quot;).remove()</span><br><span class="line">            $(&quot;#content script:last-child&quot;).remove()</span><br><span class="line">            $(&quot;#content div:last-child&quot;).remove()</span><br><span class="line">            $(&quot;#content script:last-child&quot;).remove()</span><br><span class="line">            return (&#123;</span><br><span class="line">                novelName: $(&quot;#page_set&quot;).next().next().html(),</span><br><span class="line">                title: $(&quot;h1&quot;).html(),</span><br><span class="line">                content: $(&quot;#content&quot;).html()</span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        if (result.title == &apos;&apos; || result.content == &apos;&apos;) &#123;</span><br><span class="line">            //内容为空捕获失败</span><br><span class="line">            console.log(JSON.stringify(&#123;</span><br><span class="line">                code: -1</span><br><span class="line">            &#125;))</span><br><span class="line">            return</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //判断参数进一步处理</span><br><span class="line">            if (program.puer) &#123;</span><br><span class="line">                var context = &apos;---\n&apos; +</span><br><span class="line">                    &apos;layout: \&apos;[literature]\&apos;\n&apos; +</span><br><span class="line">                    &apos;title: &apos; + result.title + &apos;\n&apos;+</span><br><span class="line">                    &apos;date: &apos; + new Date().getFullYear() + &apos;-&apos; + ((new Date().getMonth() + 1) &gt; 10 ? (new Date().getMonth() + 1) : (&apos;0&apos; + (new Date().getMonth() + 1))) + &apos;-&apos; + (new Date().getDate() &gt; 10 ? new Date().getDate() : (&apos;0&apos; + new Date().getDate())) + &apos; &apos; + new Date().getHours() + &apos;:&apos; + new Date().getMinutes() + &apos;:&apos;  + new Date().getSeconds() + &apos;\n&apos; +</span><br><span class="line">                    &apos;tags: [文学,小说,&apos;+ result.novelName +&apos;]\n&apos; +</span><br><span class="line">                    &apos;copyright: true\n&apos; +</span><br><span class="line">                    &apos;toc_number: true\n&apos; +</span><br><span class="line">                    &apos;categories: [文学,小说,&apos;+ result.novelName +&apos;]\n&apos; +</span><br><span class="line">                    &apos;comments: true\n&apos; +</span><br><span class="line">                    &apos;toc: true\n&apos; +</span><br><span class="line">                    &apos;abbrlink: f6d1cfff\n&apos; +</span><br><span class="line">                    &apos;description: &apos; + result.content.trim().substring(0,20) + &apos;...&apos;  +&apos;\n&apos; +</span><br><span class="line">                        &apos;---&apos;</span><br><span class="line">                context += puer(result.content)</span><br><span class="line">            &#125;</span><br><span class="line">            //文件模式处理后进行保存到文件.返回文件路径</span><br><span class="line">            if (program.file) &#123;</span><br><span class="line"></span><br><span class="line">                let path = &quot;&quot;</span><br><span class="line">                if (program.path) &#123;</span><br><span class="line">                    //自定义路径</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    path = DEFAULT_PATH;</span><br><span class="line">                    //避免文件夹不存在,__dirname指向的是文件所在路径</span><br><span class="line">                    mkdirp( __dirname + path, (err) =&gt; &#123;</span><br><span class="line">                    // mkdirp(&apos;../&apos; +  __dirname + path, (err) =&gt; &#123;</span><br><span class="line">                        if (err) &#123;</span><br><span class="line">                            console.log(err);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                    //拼接出文件输出的路径</span><br><span class="line">                    path += result.title + &quot;.md&quot;;</span><br><span class="line">                    await fs.writeFile(__dirname  + path, context)</span><br><span class="line">                    //输出文件名</span><br><span class="line">                    console.log(JSON.stringify(&#123;</span><br><span class="line">                        code: 1,</span><br><span class="line">                        filePath: path</span><br><span class="line">                    &#125;))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                console.log(JSON.stringify(&#123;</span><br><span class="line">                    code: 1,</span><br><span class="line">                    content: result</span><br><span class="line">                &#125;));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //exit</span><br><span class="line">    await instance.exit();</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></p><hr><h3><span id="拓展">拓展</span></h3><hr><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">await page.includeJs(&quot;https://cdn.bootcss.com/jquery/1.12.4/jquery.js&quot;)</span><br><span class="line">//可以导入其他js lib</span><br><span class="line">await page.render(&apos;germy.png&apos;);</span><br><span class="line">//渲染当前页面为图片输出</span><br></pre></td></tr></table></figure></p><p>在这里说一下为什么可以直接使用jquery,以百度为例子</p><p>因为当前页面加载的时候加载了jquery 这个lib,所以这里就可以直接使用了</p><hr><h3><span id="结合使用">结合使用</span></h3><hr><p><strong>taskHandler</strong></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">const exec = require(&apos;child_process&apos;).exec;</span><br><span class="line">const execAsync = require(&apos;async-child-process&apos;).execAsync;</span><br><span class="line">const async = require(&apos;async&apos;)</span><br><span class="line">const delayAsync = require(&apos;./asyncFetch&apos;).delayAsync;</span><br><span class="line">const program = require(&apos;commander&apos;);</span><br><span class="line">var fs = require(&apos;fs&apos;);</span><br><span class="line">const util = require(&apos;util&apos;)</span><br><span class="line">const co = require(&apos;co&apos;)</span><br><span class="line">const readAsync = util.promisify(fs.readFile)</span><br><span class="line">let cmd;</span><br><span class="line">/*</span><br><span class="line">s 是章节开始(下标是0,所以需要手动减一,第一章就是 0)</span><br><span class="line">e 是结束章节数</span><br><span class="line">l 是并发数</span><br><span class="line">m 模式</span><br><span class="line">b 书的编号</span><br><span class="line">test command:</span><br><span class="line">node taskHandler.js -s 0 -e 10 -l 3 -b 5443</span><br><span class="line">*/</span><br><span class="line">program</span><br><span class="line">.version(&apos;0.1.0&apos;)</span><br><span class="line">.option(&apos;-s, --start [start]&apos;, &apos;start chapter&apos;, 0)</span><br><span class="line">.option(&apos;-e, --end [end]&apos;, &apos;end chapter&apos;)</span><br><span class="line">.option(&apos;-l, --limit [limit]&apos;, &apos;limit async&apos;, 3)</span><br><span class="line">.option(&apos;-m, --mode [mode]&apos;, &apos;Add bbq sauce&apos;, 2)</span><br><span class="line">.option(&apos;-b, --book [book]&apos;, &apos;book number&apos;)</span><br><span class="line">.parse(process.argv);</span><br><span class="line">/*</span><br><span class="line"> 第一步获取章节连接,第二部获取章节内容并进行输出</span><br><span class="line"> 输出方式一 输出到数据库.(未实现)</span><br><span class="line"> 输出方式二 文件输出(在关注react-pdf,希望支持pdf输出)</span><br><span class="line">*/</span><br><span class="line">if (!program.book) &#123;</span><br><span class="line">return</span><br><span class="line">&#125; else &#123;</span><br><span class="line">cmd = `node fetchAllChapters.js -b $&#123;program.book&#125;`;</span><br><span class="line">&#125;</span><br><span class="line">if (!program.start || !program.end) &#123;</span><br><span class="line">console.log(&quot;must input with start-chapter and end-chapter &quot;)</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">(async function() &#123;</span><br><span class="line">let stdout = &apos;&apos;</span><br><span class="line">await execAsync(cmd, &#123;</span><br><span class="line">//default value of maxBuffer is 200KB.</span><br><span class="line">maxBuffer: 1024 * 500</span><br><span class="line">&#125;);</span><br><span class="line">console.log(111)</span><br><span class="line">    await fs.readFile(&apos;./mock/bookInfo.json&apos;,function(err,res)&#123;</span><br><span class="line">if(err)&#123;</span><br><span class="line">console.error(&apos;write error&apos;);</span><br><span class="line">&#125;</span><br><span class="line">        stdout = res.toString()</span><br><span class="line">console.log(222)</span><br><span class="line">        console.log(333)</span><br><span class="line">        let data = JSON.parse(stdout),</span><br><span class="line">            start = parseInt(program.start),</span><br><span class="line">            end = parseInt(program.end),</span><br><span class="line">            limit = parseInt(program.limit),</span><br><span class="line">            dataList = data[&apos;dataList&apos;],</span><br><span class="line">            fetchResult = null;</span><br><span class="line">        //use to debug</span><br><span class="line">        // let dataList = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];</span><br><span class="line">        if (!dataList || data.length &lt;= 0) &#123;</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(444)</span><br><span class="line">        //分发任务 每10s调取一次并发抓取10条记录</span><br><span class="line">        //截取需要的章节数</span><br><span class="line">        /*根据章节,章节是一开始,默认无序章*/</span><br><span class="line">        //dataList, start, end, limit</span><br><span class="line">        //下面是抓每章内容</span><br><span class="line">        try &#123;</span><br><span class="line">            fetchResult =  delayAsync(dataList, start, end, limit);</span><br><span class="line">            console.log(fetchResult)</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            console.log(e)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#125;)()</span><br><span class="line">const exec = require(&apos;child_process&apos;).exec;</span><br><span class="line">const execAsync = require(&apos;async-child-process&apos;).execAsync;</span><br><span class="line">const async = require(&apos;async&apos;)</span><br><span class="line">const delayAsync = require(&apos;./asyncFetch&apos;).delayAsync;</span><br><span class="line">const program = require(&apos;commander&apos;);</span><br><span class="line">var fs = require(&apos;fs&apos;);</span><br><span class="line">const util = require(&apos;util&apos;)</span><br><span class="line">const co = require(&apos;co&apos;)</span><br><span class="line">const readAsync = util.promisify(fs.readFile)</span><br><span class="line">let cmd;</span><br><span class="line">/*</span><br><span class="line">s 是章节开始(下标是0,所以需要手动减一,第一章就是 0)</span><br><span class="line">e 是结束章节数</span><br><span class="line">l 是并发数</span><br><span class="line">m 模式</span><br><span class="line">b 书的编号</span><br><span class="line">test command:</span><br><span class="line">node taskHandler.js -s 0 -e 10 -l 3 -b 5443</span><br><span class="line">*/</span><br><span class="line">program</span><br><span class="line">.version(&apos;0.1.0&apos;)</span><br><span class="line">.option(&apos;-s, --start [start]&apos;, &apos;start chapter&apos;, 0)</span><br><span class="line">.option(&apos;-e, --end [end]&apos;, &apos;end chapter&apos;)</span><br><span class="line">.option(&apos;-l, --limit [limit]&apos;, &apos;limit async&apos;, 3)</span><br><span class="line">.option(&apos;-m, --mode [mode]&apos;, &apos;Add bbq sauce&apos;, 2)</span><br><span class="line">.option(&apos;-b, --book [book]&apos;, &apos;book number&apos;)</span><br><span class="line">.parse(process.argv);</span><br><span class="line">/*</span><br><span class="line"> 第一步获取章节连接,第二部获取章节内容并进行输出</span><br><span class="line"> 输出方式一 输出到数据库.(未实现)</span><br><span class="line"> 输出方式二 文件输出(在关注react-pdf,希望支持pdf输出)</span><br><span class="line">*/</span><br><span class="line">if (!program.book) &#123;</span><br><span class="line">return</span><br><span class="line">&#125; else &#123;</span><br><span class="line">cmd = `node fetchAllChapters.js -b $&#123;program.book&#125;`;</span><br><span class="line">&#125;</span><br><span class="line">if (!program.start || !program.end) &#123;</span><br><span class="line">console.log(&quot;must input with start-chapter and end-chapter &quot;)</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">(async function() &#123;</span><br><span class="line">let stdout = &apos;&apos;</span><br><span class="line">await execAsync(cmd, &#123;</span><br><span class="line">//default value of maxBuffer is 200KB.</span><br><span class="line">maxBuffer: 1024 * 500</span><br><span class="line">&#125;);</span><br><span class="line">console.log(111)</span><br><span class="line">    await fs.readFile(&apos;./mock/bookInfo.json&apos;,function(err,res)&#123;</span><br><span class="line">if(err)&#123;</span><br><span class="line">console.error(&apos;write error&apos;);</span><br><span class="line">&#125;</span><br><span class="line">        stdout = res.toString()</span><br><span class="line">console.log(222)</span><br><span class="line">        console.log(333)</span><br><span class="line">        let data = JSON.parse(stdout),</span><br><span class="line">            start = parseInt(program.start),</span><br><span class="line">            end = parseInt(program.end),</span><br><span class="line">            limit = parseInt(program.limit),</span><br><span class="line">            dataList = data[&apos;dataList&apos;],</span><br><span class="line">            fetchResult = null;</span><br><span class="line">        //use to debug</span><br><span class="line">        // let dataList = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];</span><br><span class="line">        if (!dataList || data.length &lt;= 0) &#123;</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line">        console.log(444)</span><br><span class="line">        //分发任务 每10s调取一次并发抓取10条记录</span><br><span class="line">        //截取需要的章节数</span><br><span class="line">        /*根据章节,章节是一开始,默认无序章*/</span><br><span class="line">        //dataList, start, end, limit</span><br><span class="line">        //下面是抓每章内容</span><br><span class="line">        try &#123;</span><br><span class="line">            fetchResult =  delayAsync(dataList, start, end, limit);</span><br><span class="line">            console.log(fetchResult)</span><br><span class="line">        &#125; catch (e) &#123;</span><br><span class="line">            console.log(e)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure></p><p>这里是将两个模块结合起来,先抓取所有章节数再进行处理</p><p>这里使用async-child-process调起子进程,然后直接获取输出在控制台中的数据作为输出结果,由于async-child-process默认控制台输出的最大字节流是5kb所以要调整最大字节流的限制,不然会报错;</p><hr><h3><span id="结合async-与计时器实现延迟并发加载">结合async 与计时器实现延迟并发加载</span></h3><hr><p>这里先要说一下<a href="https://github.com/caolan/async" target="_blank" rel="noopener">async.js</a>这个库提供了许多控制并发的方法,关于async的demo可以看一下唐大大的<a href="https://github.com/alsotang/async_demo" target="_blank" rel="noopener">async demo</a>,里面有许多async method 的使用 🌰</p><p>而我们在这里使用的是 <strong>async.mapLimit()</strong></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">mapLimit(coll, limit, iteratee, callbackopt)</span><br><span class="line">params coll 是数据集合</span><br><span class="line">       limit 并发数量</span><br><span class="line">       iteratee 迭代器fun(fun 提供item 和callback,通过ca)</span><br><span class="line">       callcackopt collection执行完毕或者是错误出现执行的回调函数</span><br><span class="line"></span><br><span class="line">A callback which is called when all iteratee</span><br><span class="line">functions have finished, or an error occurs.</span><br><span class="line"> Results is an array of the transformed items</span><br><span class="line"> from the coll. Invoked with (err, results).</span><br><span class="line">*/</span><br><span class="line">//</span><br><span class="line">var arr = [&#123;name:&apos;Jack&apos;, delay:200&#125;,</span><br><span class="line">&#123;name:&apos;Mike&apos;, delay: 100&#125;,</span><br><span class="line"> &#123;name:&apos;Freewind&apos;, delay:300&#125;,</span><br><span class="line"> &#123;name:&apos;Test&apos;, delay: 50&#125;];</span><br><span class="line">async.mapLimit(arr,2, function(item, callback) &#123;</span><br><span class="line">    log(&apos;1.5 enter: &apos; + item.name);</span><br><span class="line">    setTimeout(function() &#123;</span><br><span class="line">        log(&apos;1.5 handle: &apos; + item.name);</span><br><span class="line">        if(item.name===&apos;Jack&apos;) callback(&apos;myerr&apos;);</span><br><span class="line">        else callback(null, item.name+&apos;!!!&apos;);</span><br><span class="line">    &#125;, item.delay);</span><br><span class="line">&#125;, function(err, results) &#123;</span><br><span class="line">    log(&apos;1.5 err: &apos;, err);</span><br><span class="line">    log(&apos;1.5 results: &apos;, results);</span><br><span class="line">&#125;);</span><br><span class="line">/*</span><br><span class="line">20.675&gt; 1.5 enter: Jack</span><br><span class="line">20.682&gt; 1.5 enter: Mike</span><br><span class="line">20.786&gt; 1.5 handle: Mike</span><br><span class="line">20.787&gt; 1.5 enter: Freewind</span><br><span class="line">20.887&gt; 1.5 handle: Jack</span><br><span class="line">20.887&gt; 1.5 err: myerr</span><br><span class="line">20.887&gt; 1.5 results: [ undefined, &apos;Mike!!!&apos; ]</span><br><span class="line">21.091&gt; 1.5 handle: Freewind</span><br><span class="line">*/</span><br></pre></td></tr></table></figure></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">//在看另外一段</span><br><span class="line"></span><br><span class="line">const async = require(&apos;async&apos;);</span><br><span class="line">const moment = require(&apos;moment&apos;);</span><br><span class="line">var arr = [&#123;</span><br><span class="line">name: &apos;Jack&apos;,</span><br><span class="line">delay: 200</span><br><span class="line">&#125;, &#123;</span><br><span class="line">name: &apos;Mike&apos;,</span><br><span class="line">delay: 100</span><br><span class="line">&#125;, &#123;</span><br><span class="line">name: &apos;Freewind&apos;,</span><br><span class="line">delay: 300</span><br><span class="line">&#125;, &#123;</span><br><span class="line">name: &apos;Test&apos;,</span><br><span class="line">delay: 50</span><br><span class="line">&#125;];</span><br><span class="line">var log = function(msg, obj) &#123;</span><br><span class="line">//对log进行了封装。主要是增加了秒钟的输出，通过秒数的差值方便大家对async的理解。</span><br><span class="line">process.stdout.write(moment().format(&apos;ss.SSS&apos;) + &apos;&gt; &apos;);</span><br><span class="line">if (obj !== undefined) &#123;</span><br><span class="line">process.stdout.write(msg);</span><br><span class="line">console.log(obj);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">console.log(msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">async.mapLimit(arr, 2, function(item, callback) &#123;</span><br><span class="line">log(&apos;1.5 enter: &apos; + item.name);</span><br><span class="line">setTimeout(function() &#123;</span><br><span class="line">log(&apos;1.5 handle: &apos; + item.name);</span><br><span class="line">// if (item.name === &apos;Jack&apos;) callback(&apos;myerr&apos;);</span><br><span class="line">callback(null, item.name + &apos;!!!&apos;);</span><br><span class="line">&#125;, item.delay);</span><br><span class="line">&#125;, function(err, results) &#123;</span><br><span class="line">log(&apos;1.5 err: &apos;, err);</span><br><span class="line">log(&apos;1.5 results: &apos;, results);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">18.951&gt; 1.5 enter: Jack</span><br><span class="line">18.958&gt; 1.5 enter: Mike</span><br><span class="line">19.062&gt; 1.5 handle: Mike</span><br><span class="line">19.063&gt; 1.5 enter: Freewind</span><br><span class="line">19.162&gt; 1.5 handle: Jack</span><br><span class="line">19.162&gt; 1.5 enter: Test</span><br><span class="line">19.217&gt; 1.5 handle: Test</span><br><span class="line">19.367&gt; 1.5 handle: Freewind</span><br><span class="line">19.367&gt; 1.5 err: null</span><br><span class="line">19.369&gt; 1.5 results: [ &apos;Jack!!!&apos;, &apos;Mike!!!&apos;, &apos;Freewind!!!&apos;, &apos;Test!!!&apos; ]</span><br><span class="line">*/</span><br></pre></td></tr></table></figure></p><p>更直观的看出callcackopt的调用是在error或者全部完成后调用的,result里放着的是每次callback(null,result)调用的结果以数组的形式储存,注意如果某个函数没有使用该回调,在结果里显示就是undefined至于结束后仍输出,就是异步机制的问题(或者说是cpu调度问题？),已经调起了控制台的输出后 callcackopt才调用</p><p>大概了解async.mapLimit的使用后来看一下目前我的实现和存在的问题</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">const async = require(&apos;async&apos;)</span><br><span class="line">const execAsync = require(&apos;async-child-process&apos;).execAsync;</span><br><span class="line">/*实现并发抓取的函数*/</span><br><span class="line">var asyncFetch = function(data, number, method) &#123;</span><br><span class="line">return new Promise(function(resolve, reject) &#123;</span><br><span class="line">if (!data || data.length &lt;= 0) &#123;</span><br><span class="line">reject(&quot;data not exist&quot;)</span><br><span class="line">&#125;</span><br><span class="line">let result = [];</span><br><span class="line">async.mapLimit(data, number, async(data, callback) =&gt; &#123;</span><br><span class="line">//需要设置延时不然ip会被封掉</span><br><span class="line">let cmd = `node fetchChapter.js  -u $&#123;data.link&#125; -f -p`,</span><br><span class="line">json,</span><br><span class="line">//获取一个内容就输出一个</span><br><span class="line">&#123;</span><br><span class="line">stdout</span><br><span class="line">&#125; = await execAsync(cmd, &#123;</span><br><span class="line">//default value of maxBuffer is 200KB.</span><br><span class="line">maxBuffer: 1024 * 500</span><br><span class="line">&#125;);</span><br><span class="line">/*将内容保存到json中*/</span><br><span class="line">json = JSON.parse(stdout);</span><br><span class="line">//保存index</span><br><span class="line">json.index = data.index;</span><br><span class="line">/*</span><br><span class="line">由于设置成了async,出现了多次触发err的情况,callback 不能正常工作,</span><br><span class="line">手动推入result中,但是这样顺序是不确定的,有待解决这个问题</span><br><span class="line">*/</span><br><span class="line">result.push(json);</span><br><span class="line">callback(null, json) //not work</span><br><span class="line">&#125;, function(err) &#123;</span><br><span class="line">//回调函数在全部都执行完以后执行</span><br><span class="line">if (err) &#123;</span><br><span class="line">reject(err)</span><br><span class="line">&#125;</span><br><span class="line">resolve(result)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">/*实现延时加载的函数*/</span><br><span class="line">var delayAsync = function(dataList, start, end, limit) &#123;</span><br><span class="line">return new Promise(function(resolve, reject) &#123;</span><br><span class="line">var result = [],</span><br><span class="line">counter = 0,</span><br><span class="line">checkTimer,</span><br><span class="line">checkTimeOut,</span><br><span class="line">fetchTimers = [],</span><br><span class="line">count = Math.ceil((end - start) / limit),</span><br><span class="line">remain = start - end,</span><br><span class="line">i = 0;</span><br><span class="line">if (dataList.length &lt;= 0) &#123;</span><br><span class="line">//数据长度为空就返回</span><br><span class="line">reject(&quot;error&quot;)</span><br><span class="line">return;</span><br><span class="line">&#125;</span><br><span class="line">//打印一下输入情况</span><br><span class="line">console.log(dataList)</span><br><span class="line">try &#123;</span><br><span class="line">/*章数的开始和结束*/</span><br><span class="line">console.log(`从$&#123;start&#125;到 $&#123;end&#125;`)</span><br><span class="line">let startIndex = start,</span><br><span class="line">endIndex;</span><br><span class="line">while (startIndex != end) &#123;</span><br><span class="line">/*</span><br><span class="line">需要注意的是当剩余的任务不足以达到并发数的时候</span><br><span class="line">    要保证任务分割不能出界</span><br><span class="line">*/</span><br><span class="line">if (startIndex + limit &lt; end) &#123;</span><br><span class="line">endIndex = startIndex + limit;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">//截取出界</span><br><span class="line">endIndex = end;</span><br><span class="line">&#125;</span><br><span class="line">/*分割任务*/</span><br><span class="line">chapter = dataList.slice(startIndex, endIndex);</span><br><span class="line">//通过闭包实现IIFE保存当时抓取的情况,不使用闭包绑定的数据则是运行之后的值</span><br><span class="line">(function(startIndex, endIndex, chapter) &#123;</span><br><span class="line">//通过tempTimer 保存下来</span><br><span class="line">let tempTimer = setTimeout(async function() &#123;</span><br><span class="line">//获得此次任务开始执行的时间</span><br><span class="line">let startTime = new Date(),</span><br><span class="line">time, chapterResult = [];</span><br><span class="line">//进行并发捕获执行命令</span><br><span class="line">try &#123;</span><br><span class="line">chapterResult = await asyncFetch(chapter, limit);</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">// console.log(e)</span><br><span class="line">&#125;</span><br><span class="line">result = result.concat(chapterResult)</span><br><span class="line">//用于判断任务标记</span><br><span class="line">counter++;</span><br><span class="line">time = new Date() - startTime;</span><br><span class="line">console.log(`完成抓取 $&#123;startIndex&#125; 到 $&#123;endIndex&#125; 计数器是$&#123;counter&#125; 时间是$&#123;time&#125;`)</span><br><span class="line">&#125;, i * 1000);</span><br><span class="line">fetchTimers.push(tempTimer);</span><br><span class="line"></span><br><span class="line">&#125;)(startIndex, endIndex, chapter)</span><br><span class="line">i++; //控制延时</span><br><span class="line">//推进任务进行</span><br><span class="line">startIndex = endIndex;</span><br><span class="line">&#125;</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">reject(e)</span><br><span class="line">&#125;</span><br><span class="line">/*定时判断任务是否完成*/</span><br><span class="line">checkTimer = setInterval(function() &#123;</span><br><span class="line">console.log(`counter is $&#123;counter&#125; count is $&#123;count&#125;`)</span><br><span class="line">if (counter == count) &#123;</span><br><span class="line">//清除定时器</span><br><span class="line">clearTimeout(checkTimeOut);</span><br><span class="line">//清除定时器</span><br><span class="line">clearInterval(checkTimer);</span><br><span class="line">resolve(result)</span><br><span class="line">&#125;</span><br><span class="line">&#125;, 1000);</span><br><span class="line">//or use promise all ?</span><br><span class="line">//30s计时器判断超时,超时时间暂做距离</span><br><span class="line">checkTimeOut = setTimeout(function() &#123;</span><br><span class="line">//超时清除所有定时器</span><br><span class="line">for (let i = 0; i &lt; fetchTimers.length; i++) &#123;</span><br><span class="line">clearTimeout(fetchTimers[i]);</span><br><span class="line">&#125;</span><br><span class="line">//清除定时判断</span><br><span class="line">clearInterval(checkTimer);</span><br><span class="line">console.log(&quot;timout&quot;)</span><br><span class="line">reject(result)</span><br><span class="line">&#125;, 30000);</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">asyncFetch: asyncFetch,</span><br><span class="line">delayAsync: delayAsync,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>目前在async中存在问题,callback函数不能正常工作,所以每次都是手动将结果推入结果集,导致结果集的顺序不能和原数据顺序对应,然而async官方文档中</p><blockquote><p>The callback must be called exactly once, ideally on a later tick of the JavaScript event loop.</p></blockquote><p>至少要调用一次callback？ 但是</p><p>在延时并发中考虑用await Promise.all[] 取代定时器判断任务是否结束</p><p>输出结果</p><hr><h3><span id="获取章节保存到本地json文件中">获取章节保存到本地json文件中</span></h3><hr><p>这里使用的node的fs文件的fs.writeFile模块</p><hr><h3><span id="反思">反思</span></h3><hr><p>书本的章节可以捕获一次保存在/mock/bookInfo.json本地文件中,输入书本后判断书本是否已经捕获过章节了</p><p>捕获过就从本地文件/mock/bookInfo.json中获取需要的章节,提供方法检验是否有最新章节,</p><p>以文本形式储存阅读并不方便,如何更方便的阅读</p><p>在大量捕获的时候仍会被封停,缺少应对封停的机制</p><p>添加phantom proxy 进行代理,这里引出需要写一个抓取代理并测试的服务来提供代理池</p><hr><h3><span id="参考">参考</span></h3><hr><p><a href="https://github.com/Sunshine168/fetch-novel" target="_blank" rel="noopener">本文参考</a></p>]]></content>
    
    <summary type="html">
    
      async+phantomjs制作nodejs的小说爬虫
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="node" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/node/"/>
    
    
      <category term="node" scheme="http://yoursite.com/tags/node/"/>
    
      <category term="爬虫" scheme="http://yoursite.com/tags/%E7%88%AC%E8%99%AB/"/>
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>About Programmer&#39;s Novel</title>
    <link href="http://yoursite.com/2019/04/26/programmer-novel/"/>
    <id>http://yoursite.com/2019/04/26/programmer-novel/</id>
    <published>2019-04-26T08:50:41.000Z</published>
    <updated>2019-05-11T01:45:16.686Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本文产生自知乎一话题“怎么写出一本程序员风格的修真小说？”</p></blockquote><p>终有一天我手中的编译器将成为我灵魂的一部分，这世界在我的眼中将被代码重构，我将看到山川无尽银河无垠都汇成二进制的数字河流，过往英雄都在我脑海眼前一一浮现，而我听到无数码农跪倒在我的程序面前呼喊。</p><p>他们叫我代码之神。</p><p>到那个时候，我想我一定可以找回你。</p><hr><h3><span id="一-属于代码世界">一、属于代码世界。</span></h3><hr><hr><p>这是一个属于代码的修真世界。</p><p>这世界里的每一个人，每一个东西，包括高山大海，刀剑风云，其本质都是一串数字流。</p><p>打个比方，如果你知道一块石头的内部数据结构，并且参透其中玄妙，你就能用程序改变它的一切。如果能参透自身这一个复杂的操作系统，就能重新编码自己，获得更大的能力。</p><p>所以你的程序水平的高低，决定了你的牛逼程度。</p><p>我们这些修真者，都叫程序员。</p><p>有人的地方，就有江湖。有江湖的地方，就有代码。</p><p>刚入门的时候，师傅跟我说，我们程序员修的，是一份境界。短短几句的代码里，要有最完美的逻辑，跟最精妙的算法。这本《算法导论》，你暂且拿去研修。</p><p>我们程序员，外修语言，内修算法。以数据为根，算天算地算自己。</p><p>听起来真的好酷。</p><p>但这个江湖，并不平静。几大门派，上有微软谷歌，下至百度阿里，每个门派风格迥异，暗地里都有无数摩擦。</p><p>师傅说，我们知乎派，理论见长。三大软狗、哦不，三大软神坐镇，还有无数默默搬砖的程序员，如今也算在乱世立稳了脚跟。</p><p>师傅还说，江湖虽乱，但我们修真之人，说到底还是要修自身，恩恩怨怨都是过眼云烟，自身境界才是万源之本。</p><p>我点了点头。</p><p>师傅又拍了拍我的小脑瓜，慈祥一笑。他说，如果下次天涯派那群人还过来闹事，我们一定要秉承我们的自身理念来处理他们。</p><p>我知道了，我回师傅道，我跟刘看山一定会好言相劝，么么他们个哒哒。</p><p>不。师傅转身过来，鹰眼之中精光毕露，胡须颤动的嘴唇之中，一个字一个字地吐出来。</p><p>灰飞烟灭，一个不留。</p><hr><h3><span id="二-初识">二、初识</span></h3><hr><hr><p>自我开始修真起，我练的便是C++的功夫。</p><p>虽然大师兄跟我说过，不管你学的事什么语言，都是殊途同归。我们修真之人，都不要在乎这些差别，要参透的是程序的本质。</p><p>然后他又说，不过，用Java的都是傻逼。</p><p>大师兄跟我一样，C++的功底深厚，面向对象的各种技能用的精通，只是可惜，他还没有对象。</p><p>我永远忘不了那一天，我们知乎派的山门被一众凶恶之徒所踏破，山石飞舞，浮尘弥漫，门派服务器都暂停运行。</p><p>大师兄坐在大殿房顶之上，喝一壶陈年的竹叶青。姿势潇洒，闷骚至极。</p><p>是他们，谁都知道，天涯派不止一次来闹事。</p><p>我从来没见过大师兄出过手。</p><p>天涯派的来人，在烟尘之中现出数个魁梧身影，还夹带了一声大笑和开场白：</p><p>哈哈哈哈哈哈哈，知乎派，hello world！</p><p>大师兄的眼皮都没有眨一下。</p><p>他的右手之上字符串环流浮现，左手抬起酒壶一饮而尽，右手对着虚空就是一指，那一串字符都消散在空气之中。</p><p>刹那间风云突变，一阵狂风似有形一般，沿着大师兄所指方向似一条狂龙横冲了过去，一个照面便将几个大汉吹得撞出山门之外，摔了个七荤八素。</p><p>那一霎我屏住呼吸</p><p>大师兄整了整风中凌乱的发型，说，这就叫快速傅里叶变换，将风压重新编码，所到之处，寸草不生。你们都还在解码自己，我已经开始操纵世界——天涯跟知乎，就是在这里的差距，懂？</p><p>都他妈的给老子滚</p><p>从那一刻开始，我才知道，有些人已经可以编码这个世界本身。</p><p>这才是叫修真。</p><hr><h3><span id="三-修行">三、修行</span></h3><hr><hr><p>在知乎里修行了十年，师傅说我可以下山了。</p><p>我已经熟知C++的基本技能，但师傅告诫我千万不要说自己精通C++。他说，这世界上，没有人可以说，他已经精通C++，所以即算你装逼的时候，也要装得像个样子。比如，你可以说你精通java。</p><p>我点头称是。</p><p>这十年来，我每日苦读《算法导论》和《C++ primer》，精通数据库原理跟操作系统，同龄人之中无人是我敌手，自认为天下哪里都可去得。</p><p>是为年轻气盛，是为势不可挡。</p><p>我下山之后，连连在江湖之中，将一些有一点点小名气的程序员斩于马下。</p><p>他们之中，有些是根基不稳，有些是反应迟钝，有些是冥顽不灵，有些是莽撞愚蠢。</p><p>当然，我现在说起来是云淡风轻，那是因为我在装逼。其实也经过了一番苦战，有过一些辛酸。终于有一天，我将天下程序员排行榜第一千位的马特给击败，成功登上天下程序员排行榜。</p><p>马特这个程序员，有一些狡猾。他占据第一千位，已经很久没有变过。他精通计算机图形学，经常使用一些幻境击败对手。他比他上面几位更加难缠，所以通常没有人会去挑战他。因为你赢了他，也只能到第一千位，还不如去挑战他上面的更划算一些。</p><p>可惜他遇到了我，因为我比他，更精通计算机图形学。</p><p>于是这也成为一个不大不小的消息，在江湖里传播，从此我有了一个外号，他们叫我杀马特。</p><p>俗话说树大招风，人不能太出名。</p><p>有一天看到一个酒馆，我走进去，一个风情万种的女人转过来，她问我，客官，你要喝点什么嘛？</p><p>我说，三两竹叶青。</p><p>正当我在喝酒的时候，来了一群穿着黑衣的程序员。</p><p>这群人，个个怪异，但水平很高。</p><p>江湖之中，穿黑衣的程序员，都叫黑客。</p><p>来者不善。</p><p>他们将我围起来，为首的一人说，他们是做安全的。</p><p>我心中陡然一惊。因为我看到了他们衣服里藏着的，三百六十度的环形刀刃。</p><p>一百年前，有一个叫奇虎的门派。他们每个人，都有一把神秘的三百六十度的环形刀刃，所以也叫奇虎三六零。他们声称他们的存在，是为了防止世界被破坏，为了保护世界的和平，是为了贯彻爱与真实的勇敢，他们是穿梭在江湖中的三六零。但他们却暗中做了无数秘密勾当，后来江湖人人称之魔教，BAT三大派跟一些其他门派联手围上光明顶，将其灭门。</p><p>当然，我们知乎派，也在之中出了不少的力量。</p><p>我皱眉喝酒，问他们所为何事。</p><p>那为首一人，拿过我的酒壶，仰头一灌。最后一滴酒在壶中滴落之时，无数环形刀刃在我身边出现，他的手中也倏地出现一把，朝我迎面砍来。</p><p>竟是偷袭。</p><p>刀刃之上闪过的代码我毕生未见，锋利无比，威力惊人。</p><p>我虽鼓动全身能量，瞬间编译，但也感觉凶多吉少。</p><p>这电光火石一瞬间，只听得铛地一声，数把环形刀刃通通弹落一边，那些黑衣怪人通通倒地。</p><p>我靠，我有这么强？</p><p>只听得酒馆二楼悠悠传来一个女声。要打去别的地方打吧，进来酒钱都没付，还要打我的客人，这是何理？</p><p>原来是酒馆的女老板。</p><p>她从二楼飘飘而落，将我身边灰尘一扫而空，朱唇轻启，哎呀，吓到小哥你了，真是对不起。</p><p>我以前听师傅说，对于程序员，只有两种东西是天敌。一种是御姐，一种是萝莉。我说我不信。</p><p>我现在信了。</p><hr><h3><span id="四-结衣">四、结衣</span></h3><hr><hr><p>女老板说，可以叫她结衣。</p><p>她问我叫什么，我嘟哝了半天，我说我叫杀马特。</p><p>结衣说哈哈哈哈哈哈哈你真可爱。</p><p>我说结衣，你怎么会这么强。</p><p>她说你不懂，我一个弱女子，不懂点编程之术，在这江湖里怎么开酒馆嘛。</p><p>我说结衣，你怎么这么好看。</p><p>结衣不说话了。</p><p>结衣说，你这个小流氓。</p><p>我说结衣，师傅说，我们程序员只有两种天敌，一叫御姐，二是萝莉，你是哪一种？</p><p>结衣说，我都不是。</p><p>我说，哦。其实我心里想着的，是你都是。</p><p>结衣，你跟我一起闯荡江湖去好不好？</p><p>不好，你还没我强。</p><p>哦。那等我比你强了，我们一起去闯荡江湖好不好？</p><p>结衣笑了一下说，不好。</p><p>于是我就住在了酒馆里。</p><p>因为我可能，爱上了这个女人。</p><p>我杀马特曾经以为，我这一辈子就只能爱上一个女人。后来我才知道，这世间有万千代码，万物都可编译，但你编译不了的，是自己的心。</p><p>结衣是一个看上去很好强，八面玲珑的女人。她的编程水平，比那些排行榜上五百位之后的怂蛋，不知道高到哪里去了，但是她却在这里经营一个小酒馆。</p><p>我曾经问过为什么，但是结衣不说。</p><p>她只说她在等人。</p><p>我想问她是不是在等她的意中人，但是又不好意思开口。我怕是的，那我可能要伤心。师傅说修真的程序员，不能伤心。伤心的程序员，写不出好的代码。</p><p>所以我也只能等。</p><p>终于等到有一天，那天酒馆外面都是黑漆漆的云，空气里都是紧张的、像墨水混合了砂子一样的味道。可能有沙尘暴。</p><p>结衣一脸严肃。</p><p>我说结衣，咱们把门关上避一避。</p><p>结衣一言不发，站在门口，看向远方。</p><p>过了一阵，远处黑云之中，竟然出现一个人影。霎时间，雷光闪动，暴雨如注。</p><p>结衣看了我一眼，转身腾空就飞了出去。朝着远处的黑云人影，鼓动着浑身能量，就这么飞了出去。</p><p>我大喊一声结衣，然后也跑了出去。雨越下越大，我只能隐隐看见远处电闪雷鸣，我在混乱之中大喊结衣。</p><p>他们在交战。</p><p>远处代码一行行在云端飞舞盘旋，命令与字节化为巨大的力量，我没有想到结衣竟然强到这个地步。</p><p>举手投足，山河变色。</p><p>我想起大师兄所说的，有人还在解码自身，有人已经操纵世界。</p><p>是一场恶战。</p><p>我只能站在下面看，我甚至都不知道他们交战的具体情况。</p><p>我心急如焚。</p><p>在一个天际的惊雷响彻之后，一道正弦函数冲击波将所有黑云弹射开来，而我只看到结衣在空中坠落的身影。</p><p>拨云见日，阳光普照。</p><p>在很多年之后，当我再回想起这个情形，还是觉得，即算是临死之时的结衣，在空中的身影，也那么美好。</p><p>我抱着结衣，泣不成声。</p><p>她看着我，怔怔的看着我。</p><p>她说你别哭，真的，这是注定的一天。</p><p>她说我们家以前侵入国防系统，被朝廷发现灭门，我侥幸逃脱。但是不管我在哪里，总有一天他们会找上来。</p><p>她说你是男孩子，要坚强一点。不坚强一点，你怎么成为最好的程序员。</p><p>结衣在那几分钟里，好像想把她一生没讲完的话，都给讲完。</p><p>她说的最后一句话是，杀马特，你一定不要忘了我。</p><p>然后她就再也没有说话了。</p><p>我甚至都没有问过她说，你有心上人吗？</p><p>我甚至都没有跟她说过，我是真的很喜欢你。</p><p>我甚至都没有吻过她，没有牵过她的手，我们只是这样匆匆遇到，然后匆匆告别。</p><p>她的身体将化成一串数字流，失去结构，流向无尽的原野、河流跟大地，化为三月的春风、杨柳跟雨滴。</p><p>有些东西，是命。</p><p>我的整个程序员修真生涯，在这一天，被分割开来。</p><p>对，我杀马特，在这一天之后，是一个一定要成为天下第一的程序员。</p><p>为了结衣。</p><hr><h3><span id="五-宗门">五、宗门</span></h3><hr><hr><p>并非是单单想给结衣报仇。</p><p>我们程序员的修真之路，内修自己，外修天地。</p><p>当代码可以操控天地这个最为复杂的系统之时，就一定会涉及到世界的本源之处。若这个世界的代码在我眼前一览无遗，或许我可以控制时间。</p><p>或许我可以从时间的bug里，找回结衣。</p><p>这是我这么多年来的，唯一念想。</p><p>毕竟我们程序员，生来就要逆天改命。</p><p>之后的时间里，我从程序员排行榜上一路飙升，五年之后跻身前十，成为世界上最优秀的程序员之一。</p><p>我树敌无数，也击败无数敌人。他们之中，甚至有自创一门语言的奇才，有号称已然精通C++的装逼犯，有对各类操作系统跟编译原理都熟悉无比的怪才，但是，不管谁，都无法阻挡我杀马特的脚步。</p><p>无人可挡。生来彷徨。</p><p>但，即算是到了我这样的水准，我也依旧无法知道，如何寻找这个世界里时间的bug，甚至都没有一丝头绪。</p><p>每逢debug的夜晚，我都会想起结衣，明媚如歌的笑容，和她从天而落，如佛光普照般的美丽。</p><p>但这又时时提醒了我，我可能真的已经离她远去了，而我无能为力。</p><p>这世间我认识的高手，都无法为我解答这个问题。</p><p>直到有一天，我在山间遇到一个红衣人。</p><p>他是个高手，从看到他码出第一行代码的时候，我就知道，这是个绝顶高手。</p><p>山野相逢，抛却了身份。我跟他把酒言欢，知无不谈，倒也痛快。</p><p>直到我跟他说起关于这世界里，时间的bug。</p><p>他说，这世界极有可能是在一个环形循环之中。说罢他从怀里掏出一把刀，却正是奇虎派的那把三百六十度环形刀刃。</p><p>他说你看这把刀，我派毕生所愿，即是参透这世界的圆之循环，重新编码，到时候天下唾手可得。</p><p>我说，我不想要什么天下，我只要一个女人。</p><p>红衣人哈哈大笑，说，那你加入我们，来我奇虎参透这世界运行之时最底层的命令，参透这循环，说不定你就能重新遇到那个女人。</p><p>对，我没有犹豫，我答应了。</p><p>他说，他叫周红衣。</p><hr><h3><span id="六-大师兄">六、大师兄</span></h3><hr><hr><p>我就这么加入了奇虎三六零。</p><p>彼时奇虎正在重整旗鼓，周红衣想要东山再起，他不能少了我这个助力。</p><p>从此我手里多了一把，三百六十度的，环形刀刃。</p><p>萧萧狼烟，江湖恩怨再起。</p><p>人在江湖，真的身不由己。</p><p>我一边参悟奇虎派祖传的代码跟算法，一边帮奇虎派征战天下。</p><p>我是知乎派出身，根正苗红，师傅知我落入魔教之手，吐出一口老血。孽徒，孽徒啊。他们也曾劝降，但我不为所动。</p><p>我心中，有我自己的编程之道。</p><p>所以我很清楚自己在干什么。我很清楚，男孩子，要坚强。</p><p>奇虎的势力扩张得很快，但正邪势不两立，BAT三大派见天下形势如此，便要集结程序员部队，重新再上一次光明顶。</p><p>他们说，一百年前能灭的，现在也能灭。</p><p>光明顶，是我奇虎派的大本营。</p><p>而他们带队之人，正是当今天下排行第一的程序员，出身知乎、神龙见首不见尾的大师兄。</p><p>大师兄，真的好久不见。</p><p>说实话，虽从一开始，我便知道自己背负的是什么，但我也并未想过，有一天要跟大师兄动手。也许在成为男人的路上，杀死偶像，都是不可避免的一环。</p><p>大师兄还是酒壶一把，桀骜不驯。他说傻小子，你现在过来，还真的来得及。</p><p>我说大师兄，皇皇天下，哪有什么正邪分家。无非是你来我往，你抢我杀。咱们做程序员的都知道，手底下见真章。</p><p>大师兄喝酒，哈哈大笑，他说你有长进，然后把酒壶朝天一扔。</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Talk is cheap，show me the code。</span><br></pre></td></tr></table></figure></p><hr><h3><span id="七-奇点">七、奇点</span></h3><hr><hr><p>与大师兄交战之前，我正参悟到这个世界代码的一些关键之处。</p><p>如今一战，倒是针尖对麦芒。大师兄的编程能力，已然步入化境。代码不在手上，已在心中。物质都是数据，规则都是代码，一时间天地轰隆，流云沐风皆能当锋利兵器，重力气压都能做任意改变，我跟大师兄从天到地，战了个平分秋色。</p><p>大师兄说，没想到你小子这么难缠。</p><p>大师兄说，对不起，我必须解决掉你。</p><p>为了正义。</p><p>我从没见他说过对不起，这正如他一定会放一个前所未见的大招一样可怕。</p><p>大师兄操纵无数代码，打入大地之中，蓦地瞬间，我感觉脚底重力似乎加大了无数倍。</p><p>好沉。</p><p>好一个无限重力流。</p><p>我们这边的程序员，要么被强大重力挤压变形，最舒服的也寸步不能动弹。</p><p>大师兄竟然还没有结束，他接着操纵无数代码，打入遥远天空之中，竟从无垠星海之中召来巨大陨石。</p><p>陨石当空，重力无限。</p><p>这两者相结合，他竟凭他一人之力，要横扫整个奇虎。</p><p>不愧是天下第一的旷世奇才。我承认，面对这样的攻势，我并没有什么好的办法。</p><p>但我也不后悔。</p><p>既然踏上这条路，我就没有打算过回头。</p><p>陨石从我头上落下之时，生死交错的瞬间，我仿佛又看到结衣的脸，像电影一般飞驰而过的场面。</p><p>我突然领悟到些什么。</p><p>我在那一瞬也打出无数代码，我打出的代码，跟大师兄的，一模一样。</p><p>复制代码，通常比较容易。</p><p>我脚下重力瞬间又加大无数倍，其他的程序员早已不堪重负，化为一摊数据流。而那个陨石速度越来越快，擦出巨大的热浪火花，空间都变形扭曲，周围一切化为粉末，消散无形。</p><p>我以为那个瞬间我已经死了。</p><p>而我在那一个瞬间，看到了在弯曲变形的前方，有一个时空的奇点。</p><p>时间是一个圆。</p><p>我靠近它，向死而生。</p><p>前方白光一片。</p><hr><h3><span id="八-重启">八、重启</span></h3><hr><hr><p>我睁开眼。</p><p>眼前是那个熟悉的酒馆。</p><p>我走进去，一个风情万种的女人转过来。</p><p>她问我，客官，你要喝点什么嘛？</p><hr><h3><span id="九-完">九、完</span></h3><hr><hr><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//重启万能大法好</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      山川无尽银河无垠都汇成二进制的数字河流被代码重构,过往英雄都在我脑海眼前...
    
    </summary>
    
      <category term="文学" scheme="http://yoursite.com/categories/%E6%96%87%E5%AD%A6/"/>
    
      <category term="小说" scheme="http://yoursite.com/categories/%E6%96%87%E5%AD%A6/%E5%B0%8F%E8%AF%B4/"/>
    
    
      <category term="文学" scheme="http://yoursite.com/tags/%E6%96%87%E5%AD%A6/"/>
    
      <category term="小说" scheme="http://yoursite.com/tags/%E5%B0%8F%E8%AF%B4/"/>
    
      <category term="程序员小说" scheme="http://yoursite.com/tags/%E7%A8%8B%E5%BA%8F%E5%91%98%E5%B0%8F%E8%AF%B4/"/>
    
  </entry>
  
  <entry>
    <title>微信内置浏览器 非全屏播放视频解析</title>
    <link href="http://yoursite.com/2019/04/25/wx-video-x5/"/>
    <id>http://yoursite.com/2019/04/25/wx-video-x5/</id>
    <published>2019-04-25T06:26:07.000Z</published>
    <updated>2019-05-11T01:45:16.686Z</updated>
    
    <content type="html"><![CDATA[<hr><h2><span id="前提条件">前提条件</span></h2><hr><p>接了一个项目要实现在微信公众号里课程播放，而且还有评论功能，视频需要小窗播放。首先公布解决方案：</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;video id=&quot;my-video&quot; class=&quot;video-js&quot; controls preload=&quot;auto&quot; width=&quot;100%&quot; height=&quot;300px&quot;</span><br><span class="line"> x5-playsinline=&quot;&quot; playsinline=&quot;&quot; webkit-playsinline=&quot;&quot; poster=&quot;&quot; preload=&quot;auto&quot;&gt;&lt;/video&gt;</span><br></pre></td></tr></table></figure></p><hr><h2><span id="解决过程">解决过程</span></h2><hr><p>网上百度一把片，主要是这些属性，给赋值true之类的，然而没什么卵用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">webkit-playsinline=&quot;true&quot; /*这个属性是ios 10中设置可以让视频在小窗内播放，也就是不是全屏播放*/</span><br><span class="line">  playsinline=&quot;true&quot;  /*IOS微信浏览器支持小窗内播放*/</span><br><span class="line">  x-webkit-airplay=&quot;allow&quot;</span><br><span class="line">  x5-video-player-type=&quot;h5&quot;  /*启用H5播放器,是wechat安卓版特性*/</span><br><span class="line">  x5-video-player-fullscreen=&quot;true&quot; /*全屏设置，设置为 true 是防止横屏*/&gt;</span><br><span class="line">  x5-video-orientation=&quot;portraint&quot; /*播放器支付的方向，landscape横屏，portraint竖屏，默认值为竖屏*/</span><br></pre></td></tr></table></figure></p><p>还有用canvas解决的，代码可以给你们参考写是我从csdn花了3C币买的</p><p>请自动引入jq等插件库</p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;author&quot; content=&quot;Tencent-TGideas&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;format-detection&quot; content=&quot;telephone=no&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui&quot;/&gt;</span><br><span class="line">    &lt;meta name=&quot;apple-mobile-web-app-capable&quot; content=&quot;yes&quot; /&gt;</span><br><span class="line">    &lt;meta name=&quot;apple-mobile-web-app-status-bar-style&quot; content=&quot;black&quot; /&gt;</span><br><span class="line">    &lt;title&gt;直播&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        *&#123; margin:0; padding:0; box-sizing:border-box;&#125;</span><br><span class="line">        html&#123; max-width:640px; min-width:320px; margin:0 auto;&#125;</span><br><span class="line">        img&#123; max-width:100%; vertical-align:middle;&#125;</span><br><span class="line">        .video_box&#123; width:100%; position:relative;&#125;</span><br><span class="line">        .start_video&#123; width:40px; height:40px; border-radius:50%; background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH4AAAB+CAYAAADiI6WIAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2RjFFNEQzQzYwMkExMUU2OTA2RURBNTIyNDYyMzY0NSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2RjFFNEQzRDYwMkExMUU2OTA2RURBNTIyNDYyMzY0NSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjZGMUU0RDNBNjAyQTExRTY5MDZFREE1MjI0NjIzNjQ1IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjZGMUU0RDNCNjAyQTExRTY5MDZFREE1MjI0NjIzNjQ1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/oEh8gAAEclJREFUeNrsXQtQVdUa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) no-repeat center center; background-size:100% 100%; cursor:pointer; position:absolute; left:50%; top:50%; -webkit-transform:translate(-50%,-50%); transform:translate(-50%,-50%);&#125;</span><br><span class="line">        video&#123; width:100%; vertical-align:middle; object-fit:contain; object-position:left top;&#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;div&gt;&lt;img src=&quot;http://pic.qiantucdn.com/58pic/11/32/07/98258PIC8dA.jpg&quot; /&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;video_box&quot;&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">        必须加上：</span><br><span class="line">                x5-video-player-type=&apos;h5&apos; x5-video-player-fullscreen=&apos;true&apos;　　否则视频还是跳出去 全屏 播放</span><br><span class="line">                poster=&quot;http://ossweb-img.qq.com/images/wefire/act/a20150826kris/bg_poster.jpg&quot;　　否则视频的高度可能会出问题</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;video id=&quot;testVideo&quot; x-webkit-airplay=&quot;true&quot; webkit-playsinline=&quot;true&quot; playsinline=&quot;true&quot; preload=&quot;auto&quot; x5-video-player-type=&apos;h5&apos; x5-video-player-fullscreen=&apos;true&apos; src=&quot;http://ossweb-img.qq.com/images/wefire/act/a20150826kris/v1.mp4&quot; poster=&quot;http://ossweb-img.qq.com/images/wefire/act/a20150826kris/bg_poster.jpg&quot;&gt;&lt;/video&gt;</span><br><span class="line"></span><br><span class="line">    &lt;span class=&quot;start_video&quot;&gt;&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;div style=&quot; height:300px;&quot;&gt;</span><br><span class="line">    &lt;textarea style=&quot; width:100%; height:100%; padding:10px; background-color:#eee; border:none; outline:none vertical-align:middle; resize:none; appearance:normal;&quot; placeholder=&quot;在此输入内容&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div&gt;&lt;img src=&quot;http://pic.qiantucdn.com/58pic/11/32/07/98258PIC8dA.jpg&quot; /&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;http://code.jquery.com/jquery-2.0.0.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    //判断是否为安卓设备</span><br><span class="line">    function isAndroid()&#123;</span><br><span class="line">        var u = navigator.userAgent;</span><br><span class="line">        if(u.indexOf(&apos;Android&apos;) &gt; -1 || u.indexOf(&apos;Linux&apos;) &gt; -1)&#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    var $video = $(&apos;#testVideo&apos;);</span><br><span class="line">    $(function()&#123;</span><br><span class="line">        $(&apos;.start_video&apos;).on(&quot;touchstart&quot;,function()&#123;</span><br><span class="line">            $(this).hide();</span><br><span class="line">            $video[0].play();</span><br><span class="line">        &#125;);</span><br><span class="line">        if(isAndroid())&#123;</span><br><span class="line">            $video.css(&apos;display&apos;,&apos;none&apos;).after(&apos;&lt;canvas id=&quot;testCanvas&quot; style=&quot;width:100%; vertical-align:middle;&quot;&gt;&lt;/canvas&gt;&apos;);</span><br><span class="line">            /*以上配置 安卓 机解所需元素及相关属性*/</span><br><span class="line">            var videoW , videoH;</span><br><span class="line">            setTimeout(function()&#123;</span><br><span class="line">                videoW = $video.width() * 3;</span><br><span class="line">                videoH = $video.height() * 3;</span><br><span class="line">                TestCanvas.width = videoW;</span><br><span class="line">                TestCanvas.height = videoH;</span><br><span class="line"></span><br><span class="line">                setCanvasStartImg();</span><br><span class="line">                //之所以这里要播放下，是因为经过测试，第一次点击CANVAS时，视频播放又立即停止了</span><br><span class="line">                TestVideo.play();</span><br><span class="line">                TestVideo.pause();</span><br><span class="line"></span><br><span class="line">                console.log(videoW);</span><br><span class="line">                console.log(videoH);</span><br><span class="line">                console.log(TestVideo.width);</span><br><span class="line">                console.log(TestVideo.height);</span><br><span class="line">            &#125;,100);</span><br><span class="line">            //设置CANVAS初始画面（视频封面）</span><br><span class="line">            function setCanvasStartImg()&#123;</span><br><span class="line">                var plsterImgSrc = $video.attr(&apos;poster&apos;);</span><br><span class="line">                if(plsterImgSrc)&#123;</span><br><span class="line">                    var plsterImg = new Image();</span><br><span class="line">                    plsterImg.src = plsterImgSrc;</span><br><span class="line">                    plsterImg.onload = function()&#123;</span><br><span class="line">                        TestCanvas2D.drawImage(plsterImg,0,0,videoW,videoH);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            /*以下是渲染CANVAS画布中的视频*/</span><br><span class="line"></span><br><span class="line">            //获取video</span><br><span class="line">            var TestVideo=document.getElementById(&quot;testVideo&quot;);</span><br><span class="line">            //获取canvas画布</span><br><span class="line">            var TestCanvas=document.getElementById(&quot;testCanvas&quot;);</span><br><span class="line">            //设置画布</span><br><span class="line">            var TestCanvas2D=TestCanvas.getContext(&apos;2d&apos;);</span><br><span class="line">            //设置setinterval定时器</span><br><span class="line">            var TestVideoTimer=null;</span><br><span class="line">            //监听播放</span><br><span class="line">            TestVideo.addEventListener(&apos;play&apos;,function() &#123;</span><br><span class="line">                $(&apos;.start_video&apos;).hide();</span><br><span class="line">                TestVideoTimer=setInterval(function() &#123;</span><br><span class="line">                    TestCanvas2D.drawImage(TestVideo,0,0,videoW,videoH);</span><br><span class="line">                &#125;,20);</span><br><span class="line"></span><br><span class="line">            &#125;,false);</span><br><span class="line">            //监听暂停</span><br><span class="line">            TestVideo.addEventListener(&apos;pause&apos;,function() &#123;</span><br><span class="line">                clearInterval(TestVideoTimer);</span><br><span class="line">                $(&apos;.start_video&apos;).show();</span><br><span class="line">            &#125;,false);</span><br><span class="line">            //监听结束</span><br><span class="line">            TestVideo.addEventListener(&apos;ended&apos;,function() &#123;</span><br><span class="line">                clearInterval(TestVideoTimer);</span><br><span class="line">                $(&apos;.start_video&apos;).show();</span><br><span class="line">            &#125;,false);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $video.attr(&apos;controls&apos;,&apos;controls&apos;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><hr><h2><span id="总结">总结</span></h2><hr><p>解决过程很心酸，结果最起码是美满的，毕竟解决了segmentfault上边所说的微信X5内核不能非全屏播放视频的世界级难题（皮一下，希望不会挨打）</p><p>目前这个方法亲测可以使用华为、小米、vivo、苹果、oppo</p><hr><blockquote><p>随手打赏什么不奢望，只是开通一个赞赏功能，当然了请我喝饮料我也不会介意的</p></blockquote><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;hr&gt;
&lt;h2&gt;&lt;span id=&quot;前提条件&quot;&gt;前提条件&lt;/span&gt;&lt;/h2&gt;
&lt;hr&gt;
&lt;p&gt;接了一个项目要实现在微信公众号里课程播放，而且还有评论功能，视频需要小窗播放。
首先公布解决方案：&lt;/p&gt;
&lt;p&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;
      
    
    </summary>
    
      <category term="前端" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="视频" scheme="http://yoursite.com/categories/%E5%89%8D%E7%AB%AF/%E8%A7%86%E9%A2%91/"/>
    
    
      <category term="前端" scheme="http://yoursite.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="video" scheme="http://yoursite.com/tags/video/"/>
    
      <category term="视频" scheme="http://yoursite.com/tags/%E8%A7%86%E9%A2%91/"/>
    
      <category term="X5引擎" scheme="http://yoursite.com/tags/X5%E5%BC%95%E6%93%8E/"/>
    
  </entry>
  
</feed>
